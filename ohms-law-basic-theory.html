<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電気回路シミュレーター - オームの法則・直列・並列回路</title>
    <style>
        :root {
            --primary-color: #005BAB;
            --accent-color: #FF961C;
            --light-blue: #E0EEF9;
            --medium-blue: #4D8BC9;
            --dark-grey: #616161;
            --success-color: #4CAF50;
            --warning-color: #FFC107;
            --danger-color: #F44336;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Meiryo', system-ui, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--medium-blue) 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '⚡';
            position: absolute;
            font-size: 200px;
            opacity: 0.1;
            right: -50px;
            top: -50px;
            transform: rotate(-15deg);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: rotate(-15deg) translateY(0); }
            50% { transform: rotate(-15deg) translateY(-20px); }
        }

        h1 {
            margin: 0;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .subtitle {
            font-size: 1.2rem;
            margin-top: 10px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .circuit-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .circuit-svg {
            width: 100%;
            height: 100%;
            max-height: 600px;
        }

        .electron {
            fill: var(--accent-color);
            filter: drop-shadow(0 0 5px rgba(255,150,28,0.8));
        }

        .current-flow {
            stroke: #FFD700;
            stroke-width: 3;
            fill: none;
            stroke-dasharray: 10 5;
            animation: flow 2s linear infinite;
        }

        @keyframes flow {
            0% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: -15; }
        }

        .question-box {
            background: var(--light-blue);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--primary-color);
        }

        .question-box h3 {
            color: var(--primary-color);
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .input-group label {
            font-weight: bold;
            min-width: 120px;
        }

        .input-group input {
            padding: 10px 15px;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            font-size: 1.1rem;
            width: 150px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(255,150,28,0.2);
        }

        .check-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 15px;
        }

        .check-button:hover {
            background: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,150,28,0.3);
        }

        .check-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feedback.correct {
            background: #E8F5E9;
            color: var(--success-color);
            border: 2px solid var(--success-color);
        }

        .feedback.incorrect {
            background: #FFEBEE;
            color: var(--danger-color);
            border: 2px solid var(--danger-color);
        }

        .feedback.hint {
            background: #FFF3E0;
            color: #F57C00;
            border: 2px solid var(--warning-color);
        }

        .theory-box {
            background: linear-gradient(135deg, var(--light-blue), white);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid var(--primary-color);
        }

        .formula-display {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .formula-display .main-formula {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .formula-display .sub-formula {
            font-size: 1.3rem;
            color: var(--dark-grey);
            margin: 5px 0;
        }

        .current-speed-control {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .slider-container {
            margin: 15px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .tab-navigation {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-button {
            padding: 15px 30px;
            border: none;
            background: var(--light-blue);
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--primary-color);
        }

        .tab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .tab-button.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .progress-indicator {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .progress-step {
            text-align: center;
            position: relative;
            flex: 1;
        }

        .progress-step .circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #e0e0e0;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .progress-step.completed .circle {
            background: var(--success-color);
            color: white;
        }

        .progress-step.active .circle {
            background: var(--accent-color);
            color: white;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .hint-button {
            background: var(--warning-color);
            color: black;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .hint-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(255,193,7,0.3);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .input-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .input-group label {
                min-width: auto;
            }
            
            .tab-button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .comparison-table {
                font-size: 0.9rem;
            }
            
            .comparison-table td, .comparison-table th {
                padding: 10px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>⚡ 電気回路シミュレーター</h1>
            <p class="subtitle">オームの法則・直列回路・並列回路を自分で発見しよう！</p>
        </header>

        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('basic')">基本回路</button>
            <button class="tab-button" onclick="switchTab('series')">直列回路</button>
            <button class="tab-button" onclick="switchTab('parallel')">並列回路</button>
            <button class="tab-button" onclick="switchTab('composite')">合成抵抗</button>
            <button class="tab-button" onclick="switchTab('comparison')">比較・まとめ</button>
        </div>

        <!-- 合成抵抗タブ -->
        <div id="composite-tab" class="tab-content">
            <div class="card">
                <h2>🔧 合成抵抗計算機</h2>
                
                <div class="theory-box">
                    <h3>📚 合成抵抗とは？</h3>
                    <p>複数の抵抗を組み合わせたときの全体の抵抗値を<strong>合成抵抗</strong>と呼びます。</p>
                    
                    <div class="formula-display">
                        <div class="sub-formula">直列回路の合成抵抗</div>
                        <div class="main-formula">R = R₁ + R₂ + R₃ + ...</div>
                        <div class="sub-formula">並列回路の合成抵抗</div>
                        <div class="main-formula">1/R = 1/R₁ + 1/R₂ + 1/R₃ + ...</div>
                    </div>
                </div>

                <div class="circuit-container">
                    <h3>⚙️ 合成抵抗シミュレーター</h3>
                    
                    <div class="input-group">
                        <label>回路の種類:</label>
                        <select id="circuit-type" onchange="updateCompositeCircuit()">
                            <option value="series">直列回路</option>
                            <option value="parallel">並列回路</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label>抵抗R₁ (Ω):</label>
                        <input type="number" id="r1-input" value="100" min="1" max="10000" oninput="updateCompositeCircuit()">
                    </div>
                    
                    <div class="input-group">
                        <label>抵抗R₂ (Ω):</label>
                        <input type="number" id="r2-input" value="200" min="1" max="10000" oninput="updateCompositeCircuit()">
                    </div>
                    
                    <div class="input-group">
                        <label>抵抗R₃ (Ω):</label>
                        <input type="number" id="r3-input" value="300" min="1" max="10000" oninput="updateCompositeCircuit()">
                    </div>
                    
                    <div class="circuit-container">
                        <svg class="circuit-svg" viewBox="0 0 950 600" style="background: white;" id="composite-circuit">
                            <!-- 回路図がここに描画されます -->
                        </svg>
                    </div>
                    
                    <div class="question-box">
                        <h3>📊 計算結果</h3>
                        <div id="composite-result" style="font-size: 1.2rem; font-weight: bold; color: var(--primary-color);">
                            合成抵抗を計算中...
                        </div>
                        
                        <div id="composite-explanation" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                            計算過程の説明がここに表示されます
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 比較・まとめタブ -->
        <div id="comparison-tab" class="tab-content">
            <div class="card" style="max-width: 1000px; margin: 0 auto;">
                <h2>📊 回路の種類と特徴の比較</h2>
                
                <div class="comparison-table" style="overflow-x: auto; margin: 20px 0;">
                    <table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: var(--primary-color); color: white;">
                                <th style="padding: 15px; text-align: left;">項目</th>
                                <th style="padding: 15px; text-align: center;">基本回路</th>
                                <th style="padding: 15px; text-align: center;">直列回路</th>
                                <th style="padding: 15px; text-align: center;">並列回路</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #f8f9fa;">
                                <td style="padding: 15px; font-weight: bold;">回路図</td>
                                <td style="padding: 15px; text-align: center;">
                                    <svg width="150" height="100" viewBox="0 0 150 100">
                                        <rect x="10" y="40" width="20" height="20" fill="#333"/>
                                        <circle cx="75" cy="50" r="15" fill="#FFE082"/>
                                        <rect x="120" y="40" width="20" height="20" fill="#4D8BC9"/>
                                        <line x1="30" y1="50" x2="60" y2="50" stroke="black" stroke-width="2"/>
                                        <line x1="90" y1="50" x2="120" y2="50" stroke="black" stroke-width="2"/>
                                    </svg>
                                </td>
                                <td style="padding: 15px; text-align: center;">
                                    <svg width="150" height="100" viewBox="0 0 150 100">
                                        <rect x="10" y="40" width="20" height="20" fill="#333"/>
                                        <circle cx="50" cy="50" r="10" fill="#FFE082"/>
                                        <circle cx="85" cy="50" r="10" fill="#FFE082"/>
                                        <rect x="120" y="40" width="20" height="20" fill="#4D8BC9"/>
                                        <line x1="30" y1="50" x2="40" y2="50" stroke="black" stroke-width="2"/>
                                        <line x1="60" y1="50" x2="75" y2="50" stroke="black" stroke-width="2"/>
                                        <line x1="95" y1="50" x2="120" y2="50" stroke="black" stroke-width="2"/>
                                    </svg>
                                </td>
                                <td style="padding: 15px; text-align: center;">
                                    <svg width="150" height="100" viewBox="0 0 150 100">
                                        <rect x="10" y="40" width="20" height="20" fill="#333"/>
                                        <circle cx="75" cy="30" r="10" fill="#FFE082"/>
                                        <circle cx="75" cy="70" r="10" fill="#FFE082"/>
                                        <rect x="120" y="40" width="20" height="20" fill="#4D8BC9"/>
                                        <line x1="30" y1="50" x2="50" y2="50" stroke="black" stroke-width="2"/>
                                        <line x1="50" y1="50" x2="50" y2="30" stroke="black" stroke-width="2"/>
                                        <line x1="50" y1="50" x2="50" y2="70" stroke="black" stroke-width="2"/>
                                        <line x1="50" y1="30" x2="65" y2="30" stroke="black" stroke-width="2"/>
                                        <line x1="50" y1="70" x2="65" y2="70" stroke="black" stroke-width="2"/>
                                        <line x1="85" y1="30" x2="100" y2="30" stroke="black" stroke-width="2"/>
                                        <line x1="85" y1="70" x2="100" y2="70" stroke="black" stroke-width="2"/>
                                        <line x1="100" y1="30" x2="100" y2="50" stroke="black" stroke-width="2"/>
                                        <line x1="100" y1="70" x2="100" y2="50" stroke="black" stroke-width="2"/>
                                        <line x1="100" y1="50" x2="120" y2="50" stroke="black" stroke-width="2"/>
                                    </svg>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 15px; font-weight: bold;">合成抵抗の計算</td>
                                <td style="padding: 15px; text-align: center;">単一抵抗のみ<br><strong>R = 抵抗値</strong></td>
                                <td style="padding: 15px; text-align: center; background: #E8F5E9;">
                                    <strong>R = R₁ + R₂ + ...</strong><br>
                                    例：2Ω + 3Ω = 5Ω
                                </td>
                                <td style="padding: 15px; text-align: center; background: #FFF3E0;">
                                    <strong>1/R = 1/R₁ + 1/R₂ + ...</strong><br>
                                    例：(6×3)÷(6+3) = 2Ω
                                </td>
                            </tr>
                            <tr style="background: #f8f9fa;">
                                <td style="padding: 15px; font-weight: bold;">電流の特徴</td>
                                <td style="padding: 15px; text-align: center;">一定</td>
                                <td style="padding: 15px; text-align: center; color: var(--primary-color); font-weight: bold;">どこでも同じ</td>
                                <td style="padding: 15px; text-align: center; color: var(--accent-color); font-weight: bold;">分配される</td>
                            </tr>
                            <tr>
                                <td style="padding: 15px; font-weight: bold;">電圧の特徴</td>
                                <td style="padding: 15px; text-align: center;">電源電圧と同じ</td>
                                <td style="padding: 15px; text-align: center; color: var(--accent-color); font-weight: bold;">分配される</td>
                                <td style="padding: 15px; text-align: center; color: var(--primary-color); font-weight: bold;">どこでも同じ</td>
                            </tr>
                            <tr style="background: #f8f9fa;">
                                <td style="padding: 15px; font-weight: bold;">実例</td>
                                <td style="padding: 15px;">単純な懐中電灯</td>
                                <td style="padding: 15px;">クリスマスツリーの電球<br>（1つ切れると全部消える）</td>
                                <td style="padding: 15px;">家庭のコンセント<br>（複数の家電を同時使用）</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="theory-box" style="margin-top: 30px;">
                    <h3>🎓 重要なポイント</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div>
                            <h4 style="color: var(--primary-color);">直列回路</h4>
                            <ul>
                                <li>抵抗を増やすと全体の抵抗が<strong>増える</strong></li>
                                <li>電流は<strong>減る</strong></li>
                                <li>1つの部品が壊れると<strong>全体が動かない</strong></li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="color: var(--accent-color);">並列回路</h4>
                            <ul>
                                <li>抵抗を増やすと全体の抵抗が<strong>減る</strong></li>
                                <li>総電流は<strong>増える</strong></li>
                                <li>1つの部品が壊れても<strong>他は動く</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="formula-display" style="margin-top: 30px;">
                    <h3 style="color: var(--primary-color); margin-bottom: 20px;">🔧 実用的な使い分け</h3>
                    <div style="text-align: left; padding: 0 20px;">
                        <p><strong>直列回路が適している場合：</strong></p>
                        <ul style="margin-bottom: 20px;">
                            <li>電圧を分配したいとき（電圧分割回路）</li>
                            <li>電流を制限したいとき（保護抵抗）</li>
                            <li>すべての部品を同時に制御したいとき</li>
                        </ul>
                        
                        <p><strong>並列回路が適している場合：</strong></p>
                        <ul>
                            <li>複数の機器を独立して使いたいとき（家庭の配線）</li>
                            <li>同じ電圧を各部品に供給したいとき</li>
                            <li>故障に強い回路にしたいとき</li>
                        </ul>
                    </div>
                </div>

                <div class="question-box" style="margin-top: 30px;">
                    <h3>🎯 総合問題</h3>
                    <p>3つの同じ電球（各6Ω）を使って、最も明るく光らせるにはどう接続すればよいでしょうか？</p>
                    
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin: 10px 0;">
                            <input type="radio" name="final-answer" value="series"> すべて直列に接続
                        </label>
                        <label style="display: block; margin: 10px 0;">
                            <input type="radio" name="final-answer" value="parallel"> すべて並列に接続
                        </label>
                        <label style="display: block; margin: 10px 0;">
                            <input type="radio" name="final-answer" value="mixed"> 2つ直列＋1つ並列
                        </label>
                        <button class="check-button" onclick="checkFinalAnswer()">確認</button>
                    </div>

                    <div id="final-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- 基本回路タブ -->
        <div id="basic-tab" class="tab-content active">

        <div class="progress-indicator">
            <div class="progress-step active" id="step1">
                <div class="circle">1</div>
                <div>回路を観察</div>
            </div>
            <div class="progress-step" id="step2">
                <div class="circle">2</div>
                <div>値を計算</div>
            </div>
            <div class="progress-step" id="step3">
                <div class="circle">3</div>
                <div>法則を理解</div>
            </div>
        </div>

        <div class="main-content">
            <div class="card">
                <h2>🔬 実験回路</h2>
                
                <div class="circuit-container">
                    <svg class="circuit-svg" viewBox="0 0 950 600" style="background: white;">
                        <!-- グラデーション定義（既存のものを使用） -->
                        <defs>
                            <!-- 電池用グラデーション -->
                            <linearGradient id="batt_goldMetalGradient" x1="0.5" y1="0" x2="0.5" y2="1">
                                <stop offset="0%" stop-color="#F0E68C"/> <stop offset="15%" stop-color="#D4AF37"/> <stop offset="50%" stop-color="#B8860B"/> <stop offset="85%" stop-color="#D4AF37"/> <stop offset="100%" stop-color="#F0E68C"/>
                            </linearGradient>
                            <linearGradient id="batt_goldHighlight" x1="0.5" y1="0" x2="0.5" y2="1">
                                <stop offset="0%" stop-color="white" stop-opacity="0.5"/> <stop offset="100%" stop-color="white" stop-opacity="0"/>
                            </linearGradient>
                            <linearGradient id="batt_mainBlueGradient" x1="0.5" y1="0" x2="0.5" y2="1">
                                <stop offset="0%" stop-color="#002855"/> <stop offset="100%" stop-color="#003366"/>
                            </linearGradient>
                            <linearGradient id="batt_centerBlueBeam" x1="0.5" y1="0" x2="0.5" y2="1">
                                <stop offset="0%" stop-color="#6CB4EE"/> <stop offset="50%" stop-color="#1E90FF"/> <stop offset="100%" stop-color="#4682B4"/>
                            </linearGradient>
                            <linearGradient id="batt_blueBeamSideFade" x1="0" y1="0.5" x2="1" y2="0.5">
                                <stop offset="0%" stop-color="#003366" stop-opacity="1"/> <stop offset="15%" stop-color="#1E90FF" stop-opacity="0.8"/> <stop offset="50%" stop-color="#1E90FF" stop-opacity="1"/> <stop offset="85%" stop-color="#1E90FF" stop-opacity="0.8"/> <stop offset="100%" stop-color="#003366" stop-opacity="1"/>
                            </linearGradient>
                            <linearGradient id="batt_simpleTerminalGradient" x1="0.5" y1="0" x2="0.5" y2="1">
                                <stop offset="0%" stop-color="#E0E0E0"/> <stop offset="50%" stop-color="#BDBDBD"/> <stop offset="100%" stop-color="#D0D0D0"/>
                            </linearGradient>
                            <linearGradient id="batt_batterySideShine" x1="0.5" y1="0" x2="0.5" y2="1">
                                <stop offset="0%" stop-color="white" stop-opacity="0.35"/> <stop offset="50%" stop-color="white" stop-opacity="0.1"/> <stop offset="100%" stop-color="white" stop-opacity="0.35"/>
                            </linearGradient>

                            <!-- 電球用グラデーション -->
                            <radialGradient id="bulb_glassShineIconYellow" cx="40%" cy="30%" r="70%" fx="30%" fy="25%">
                                <stop offset="0%" style="stop-color:white; stop-opacity:0.3"/> <stop offset="100%" style="stop-color:rgba(255,235,59,0.03);"/>
                            </radialGradient>
                            <linearGradient id="bulb_metalShine" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#E8E8E8;"/> <stop offset="30%" style="stop-color:#C0C0C0;"/> <stop offset="70%" style="stop-color:#C0C0C0;"/> <stop offset="100%" style="stop-color:#E8E8E8;"/>
                            </linearGradient>
                            <radialGradient id="bulb_bulbInnerGlowIconYellow" cx="50" cy="55" r="32" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" style="stop-color:rgba(255, 235, 59, 1.0);"/> <stop offset="25%" style="stop-color:rgba(255, 238, 100, 0.9);"/> <stop offset="60%" style="stop-color:rgba(255, 242, 140, 0.5);"/> <stop offset="100%" style="stop-color:rgba(255, 245, 170, 0.1);"/>
                            </radialGradient>
                            <filter id="bulb_filamentGlowEffectIconYellow" x="-75%" y="-75%" width="250%" height="250%">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="1.8" result="blur"/> <feFlood flood-color="#FFEB3B" flood-opacity="0.9" result="glowColor"/> <feComposite in="glowColor" in2="blur" operator="in" result="coloredBlur"/>
                                <feMerge> <feMergeNode in="coloredBlur"/> <feMergeNode in="SourceGraphic"/> </feMerge>
                            </filter>

                            <!-- マルチメーター用グラデーション -->
                            <linearGradient id="meter_bodyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#4A4A4A;stop-opacity:1" /> <stop offset="100%" style="stop-color:#303030;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="meter_buttonGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#606060;stop-opacity:1" /> <stop offset="100%" style="stop-color:#454545;stop-opacity:1" />
                            </linearGradient>
                            <radialGradient id="meter_rotaryGradient" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                                <stop offset="0%" style="stop-color:#505050;stop-opacity:1" /> <stop offset="100%" style="stop-color:#383838;stop-opacity:1" />
                            </radialGradient>
                            <linearGradient id="meter_knobGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#2A2A2A;"/> <stop offset="50%" style="stop-color:#1A1A1A;"/> <stop offset="100%" style="stop-color:#2A2A2A;"/>
                            </linearGradient>
                            <linearGradient id="meter_probeHandleBlack" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#282828;"/> <stop offset="50%" style="stop-color:#101010;"/> <stop offset="100%" style="stop-color:#282828;"/>
                            </linearGradient>
                            <linearGradient id="meter_probeHandleRed" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#D00000;"/> <stop offset="50%" style="stop-color:#A00000;"/> <stop offset="100%" style="stop-color:#D00000;"/>
                            </linearGradient>
                            <linearGradient id="meter_metalTipGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#E0E0E0" /> <stop offset="50%" style="stop-color:#B0B0B0" /> <stop offset="100%" style="stop-color:#E0E0E0" />
                            </linearGradient>
                            <filter id="meter_dropShadow" x="-20%" y="-20%" width="140%" height="140%">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="1.5"/> <feOffset dx="1" dy="1" result="offsetblur"/> <feFlood flood-color="rgba(0,0,0,0.3)"/> <feComposite in2="offsetblur" operator="in"/>
                                <feMerge> <feMergeNode/> <feMergeNode in="SourceGraphic"/> </feMerge>
                            </filter>
                            <linearGradient id="meter_glassReflection" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:rgba(255,255,255,0.2); stop-opacity:1" /> <stop offset="40%" style="stop-color:rgba(255,255,255,0.05); stop-opacity:1" /> <stop offset="100%" style="stop-color:rgba(255,255,255,0); stop-opacity:1" />
                            </linearGradient>
                        </defs>

                        <!-- 電池 -->
                        <g id="battery_component" transform="translate(50, 420) scale(1.3)">
                            <rect x="9" y="19" width="82" height="127" rx="3" ry="3" fill="#333333"/>
                            <rect x="10" y="20" width="80" height="15" fill="url(#batt_goldMetalGradient)" rx="2" ry="2"/>
                            <rect x="10" y="20" width="80" height="3" fill="url(#batt_goldHighlight)" rx="2" ry="2"/>
                            <rect x="10" y="35" width="80" height="95" fill="url(#batt_mainBlueGradient)"/>
                            <rect x="28" y="35" width="44" height="95" fill="url(#batt_blueBeamSideFade)"/>
                            <rect x="35" y="35" width="30" height="95" fill="url(#batt_centerBlueBeam)"/>
                            <path d="M10,130 L10,118 C30,128 70,128 90,118 L90,130 Z" fill="url(#batt_goldMetalGradient)"/>
                            <path d="M10,118 C30,128 70,128 90,118 L90,120 C70,130 30,130 10,120 Z" fill="url(#batt_goldHighlight)" fill-opacity="0.7"/>
                            <rect x="10.2" y="20.2" width="1.2" height="109.6" fill="url(#batt_batterySideShine)" rx="1" ry="1"/>
                            <rect x="88.6" y="20.2" width="1.2" height="109.6" fill="url(#batt_batterySideShine)" rx="1" ry="1"/>
                            <rect id="battery_left_terminal_rect" x="30" y="10" width="10" height="10" fill="url(#batt_simpleTerminalGradient)" rx="1" ry="1"/>
                            <rect id="battery_right_terminal_rect" x="60" y="10" width="10" height="10" fill="url(#batt_simpleTerminalGradient)" rx="1" ry="1"/>
                            <g transform="translate(22.5, 27.5)"> <circle cx="0" cy="0" r="5" fill="white"/> <rect x="-2.5" y="-0.8" width="5" height="1.6" fill="#003366"/> </g>
                            <g transform="translate(77.5, 27.5)"> <circle cx="0" cy="0" r="5" fill="white"/> <path d="M-2.5,0 H2.5 M0,-2.5 V2.5" stroke="#003366" stroke-width="1.5" stroke-linecap="round"/> </g>
                            <text x="50" y="82" fill="white" font-family="'Impact', 'Arial Black', sans-serif" font-size="18" transform="rotate(-90, 50, 82)" text-anchor="middle" letter-spacing="0.5">VOLTMAX</text>
                            <text x="50.5" y="82.5" fill="#002244" fill-opacity="0.5" font-family="'Impact', 'Arial Black', sans-serif" font-size="18" transform="rotate(-90, 50.5, 82.5)" text-anchor="middle" letter-spacing="0.5">VOLTMAX</text>
                            <text x="50" y="125.5" fill="#002855" font-family="Arial, sans-serif" font-size="7" text-anchor="middle" font-weight="bold" id="voltage-display">9V</text>
                        </g>

                        <!-- 電球（抵抗） -->
                        <g id="lightbulb_component" transform="translate(250, 50) scale(1)">
                            <g id="bulb_lightbulb-on-icon-yellow">
                                <g id="bulb_cap">
                                    <rect x="36" y="98" width="28" height="32" fill="url(#bulb_metalShine)" stroke="#777" stroke-width="0.5"/>
                                    <line x1="36" y1="103" x2="64" y2="103" stroke="#999" stroke-width="1.2"/> <line x1="36" y1="108" x2="64" y2="108" stroke="#999" stroke-width="1.2"/>
                                    <line x1="36" y1="113" x2="64" y2="113" stroke="#999" stroke-width="1.2"/> <line x1="36" y1="118" x2="64" y2="118" stroke="#999" stroke-width="1.2"/>
                                    <ellipse id="bulb_bottom_contact" cx="50" cy="130" rx="7" ry="2" fill="#444" />
                                </g>
                                <circle cx="50" cy="55" r="30" fill="url(#bulb_bulbInnerGlowIconYellow)" opacity="1.0" id="bulb-glow"/>
                                <path id="bulb_glass-bulb-shape-on-icon-yellow" d="M 50 5 C 18 5, 8 30, 12 55 C 16 80, 28 100, 36 100 L 64 100 C 72 100, 84 80, 88 55 C 92 30, 82 5, 50 5 Z" fill="rgba(255, 248, 210, 0.3)" stroke="rgba(220, 195, 140, 0.6)" stroke-width="1"/>
                                <g id="bulb_filament-assembly-on-icon-yellow" stroke-width="1">
                                    <path d="M 46 98 Q 50 90, 54 98 L 50 72 Z" fill="rgba(240,235,210,0.2)" stroke="#B0C0C0"/>
                                    <line x1="50" y1="72" x2="44" y2="60" stroke="#888"/> <line x1="50" y1="72" x2="56" y2="60" stroke="#888"/>
                                    <line x1="44" y1="60" x2="44" y2="52" stroke="#888"/> <line x1="56" y1="60" x2="56" y2="52" stroke="#888"/>
                                    <g filter="url(#bulb_filamentGlowEffectIconYellow)">
                                        <path d="M 44 52 C 46 47, 54 47, 56 52" stroke="#FFFAAA" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                                        <path d="M 45 55 C 47 50, 53 50, 55 55" stroke="#FFFAAA" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                                    </g>
                                </g>
                                <path id="bulb_glass-highlight-on-icon-yellow" d="M 50 5 C 18 5, 8 30, 12 55 C 16 80, 28 100, 36 100 L 64 100 C 72 100, 84 80, 88 55 C 92 30, 82 5, 50 5 Z" fill="url(#bulb_glassShineIconYellow)" opacity="0.7"/>
                            </g>
                        </g>
                        <text x="300" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" fill="#005BAB" font-weight="bold" id="resistance-display">3Ω</text>

                        <!-- マルチメーター -->
                        <g id="multimeter_component" transform="translate(450, 150) scale(0.6) rotate(30 125 200)">
                            <rect x="50" y="10" width="120" height="260" rx="10" ry="10" fill="url(#meter_bodyGradient)" filter="url(#meter_dropShadow)"/>
                            <rect x="52" y="12" width="116" height="256" rx="8" ry="8" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                            <rect x="65" y="30" width="90" height="50" fill="#8AB830" rx="3" ry="3"/>
                            <rect x="66" y="31" width="88" height="48" fill="none" stroke="rgba(0,0,0,0.2)" stroke-width="1" rx="2" ry="2"/>
                            <text x="110" y="63" font-family="Consolas, 'Courier New', monospace" font-size="28" fill="#202020" text-anchor="middle" font-weight="bold" id="current-display">?A</text>
                            <rect x="65" y="30" width="90" height="50" fill="url(#meter_glassReflection)" rx="3" ry="3"/>
                            <g filter="url(#meter_dropShadow)">
                                <rect x="65" y="90" width="20" height="12" rx="2" ry="2" fill="url(#meter_buttonGradient)"/> <rect x="88" y="90" width="20" height="12" rx="2" ry="2" fill="url(#meter_buttonGradient)"/>
                                <rect x="111" y="90" width="20" height="12" rx="2" ry="2" fill="url(#meter_buttonGradient)"/> <rect x="134" y="90" width="20" height="12" rx="2" ry="2" fill="url(#meter_buttonGradient)"/>
                                <rect x="75" y="107" width="28" height="12" rx="2" ry="2" fill="url(#meter_buttonGradient)"/> <rect x="117" y="107" width="28" height="12" rx="2" ry="2" fill="url(#meter_buttonGradient)"/>
                            </g>
                            <circle cx="110" cy="170" r="40" fill="url(#meter_rotaryGradient)" filter="url(#meter_dropShadow)"/>
                            <g stroke="#888888" stroke-width="1.5" stroke-linecap="round">
                                <line x1="110" y1="133" x2="110" y2="128" transform="rotate(0 110 170)"/> <line x1="110" y1="133" x2="110" y2="128" transform="rotate(30 110 170)"/>
                                <line x1="110" y1="133" x2="110" y2="128" transform="rotate(60 110 170)"/> <line x1="110" y1="133" x2="110" y2="128" transform="rotate(90 110 170)"/>
                                <line x1="110" y1="133" x2="110" y2="128" transform="rotate(120 110 170)"/> <line x1="110" y1="133" x2="110" y2="128" transform="rotate(150 110 170)"/>
                                <line x1="110" y1="133" x2="110" y2="128" transform="rotate(180 110 170)"/> <line x1="110" y1="133" x2="110" y2="128" transform="rotate(210 110 170)"/>
                                <line x1="110" y1="133" x2="110" y2="128" transform="rotate(240 110 170)"/> <line x1="110" y1="133" x2="110" y2="128" transform="rotate(270 110 170)"/>
                                <line x1="110" y1="133" x2="110" y2="128" transform="rotate(300 110 170)"/> <line x1="110" y1="133" x2="110" y2="128" transform="rotate(330 110 170)"/>
                            </g>
                            <rect x="102" y="138" width="16" height="32" rx="3" ry="3" fill="url(#meter_knobGradient)" transform="rotate(45 110 170)" stroke="#101010" stroke-width="0.5"/>
                            <rect x="108" y="140" width="4" height="8" fill="#606060" transform="rotate(45 110 170)" rx="1" ry="1"/>
                            <circle cx="110" cy="230" r="8" fill="url(#meter_buttonGradient)" filter="url(#meter_dropShadow)"/>
                            <circle cx="85" cy="255" r="8" fill="#1A1A1A"/> <circle cx="85" cy="255" r="6" fill="#303030"/> <circle cx="85" cy="255" r="3" fill="#101010"/>
                            <circle cx="135" cy="255" r="8" fill="red"/> <circle cx="135" cy="255" r="6" fill="#FF5050"/> <circle cx="135" cy="255" r="3" fill="#B00000"/>
                            <g id="meter_black-probe-assembly">
                                <path d="M 85 263 Q 60 300 75 370" stroke="#252525" stroke-width="4.5" fill="none" stroke-linecap="round"/>
                                <g transform="rotate(-15 75 370)">
                                    <rect x="70" y="320" width="10" height="50" rx="3" ry="3" fill="url(#meter_probeHandleBlack)"/>
                                    <rect x="71" y="300" width="8" height="20" fill="url(#meter_metalTipGradient)"/>
                                    <polygon id="meter_black_probe_tip_polygon" points="71,300 79,300 75,290" fill="url(#meter_metalTipGradient)"/>
                                </g>
                            </g>
                            <g id="meter_red-probe-assembly">
                                <path d="M 135 263 Q 160 300 145 370" stroke="#252525" stroke-width="4.5" fill="none" stroke-linecap="round"/>
                                <g transform="rotate(15 145 370)">
                                    <rect x="140" y="320" width="10" height="50" rx="3" ry="3" fill="url(#meter_probeHandleRed)"/>
                                    <rect x="141" y="300" width="8" height="20" fill="url(#meter_metalTipGradient)"/>
                                    <polygon id="meter_red_probe_tip_polygon" points="141,300 149,300 145,290" fill="url(#meter_metalTipGradient)"/>
                                </g>
                            </g>
                        </g>

                        <!-- オームの法則図 -->
                        <g id="ohmslaw_diagram_component" transform="translate(710, 50) scale(0.6)">
                            <style> .ohm_circle-bg { fill: #005BAB; stroke: #FF961C; stroke-width: 2; } .ohm_divider-line { stroke: #FF961C; stroke-width: 2; } .ohm_label { font-family: Arial, sans-serif; font-size: 36px; font-weight: bold; text-anchor: middle; dominant-baseline: middle; fill: #FF961C; } </style>
                            <circle cx="100" cy="100" r="80" class="ohm_circle-bg"/>
                            <line x1="20" y1="100" x2="180" y2="100" class="ohm_divider-line"/>
                            <line x1="100" y1="100" x2="100" y2="180" class="ohm_divider-line"/>
                            <text x="100" y="65" class="ohm_label">V</text>
                            <text x="60" y="140" class="ohm_label">I</text>
                            <text x="140" y="140" class="ohm_label">R</text>
                        </g>

                        <!-- 配線 -->
                        <g id="wires" stroke-width="3" fill="none">
                            <!-- 電池左側から電球底部へ -->
                            <path d="M 95.5 433 V 180 H 300" stroke="black" class="current-flow"/>
                            <!-- 電池右側からマルチメーターへ -->
                            <polyline points="134.5,433 134.5,420 485.0,420 485.0,360.1" stroke="black" class="current-flow"/>
                            <!-- マルチメーターから電球へ -->
                            <polyline points="450.1,340.7 450.1,180 300,180" stroke="red" class="current-flow"/>
                        </g>

                        <!-- 電子のアニメーション -->
                        <g id="electrons">
                            <!-- 電子は後でJavaScriptで動的に追加 -->
                        </g>

                        <!-- 電子の経路（非表示） -->
                        <path id="electron-path" d="M 95.5 433 V 180 H 300 L 450.1,180 L 450.1,340.7 L 485.0,360.1 L 485.0,420 L 134.5,420 L 134.5,433" fill="none"/>
                    </svg>
                </div>

                <div class="current-speed-control">
                    <h3>⚡ 電流の速さ（視覚化用）</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>電子の動き：</span>
                            <span id="speed-display">通常</span>
                        </div>
                        <input type="range" class="slider" id="speed-slider" min="0.5" max="5" value="2" step="0.5">
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>📝 問題に挑戦！</h2>

                <div class="theory-box">
                    <h3>🔍 回路を観察してみよう</h3>
                    <p>左の回路には以下の要素があります：</p>
                    <ul>
                        <li>📦 <strong>電池（電源）</strong>：9V の電圧を供給</li>
                        <li>💡 <strong>電球（抵抗）</strong>：3Ω の抵抗値</li>
                        <li>📊 <strong>電流計</strong>：流れる電流を測定（値は？）</li>
                    </ul>
                </div>

                <div class="question-box">
                    <h3>❓ 問題1：電流の値を求めよう</h3>
                    <p>電圧が <strong>9V</strong>、抵抗が <strong>3Ω</strong> のとき、流れる電流は何アンペアでしょうか？</p>
                    
                    <div class="formula-display">
                        <div class="main-formula">V = I × R</div>
                        <div class="sub-formula">電圧 = 電流 × 抵抗</div>
                    </div>

                    <div class="input-group">
                        <label>電流 (I)：</label>
                        <input type="number" id="current-answer" placeholder="？" step="0.1">
                        <span>A（アンペア）</span>
                        <button class="check-button" onclick="checkAnswer('current')">確認</button>
                        <button class="hint-button" onclick="showHint('current')">💡 ヒント</button>
                    </div>

                    <div id="current-feedback" class="feedback"></div>
                </div>

                <div class="question-box" id="question2" style="display: none;">
                    <h3>❓ 問題2：別の条件で考えてみよう</h3>
                    <p>もし電圧を <strong>12V</strong> に変えたら、電流はどうなるでしょうか？</p>
                    
                    <div class="input-group">
                        <label>電流 (I)：</label>
                        <input type="number" id="current-answer2" placeholder="？" step="0.1">
                        <span>A（アンペア）</span>
                        <button class="check-button" onclick="checkAnswer('current2')">確認</button>
                        <button class="hint-button" onclick="showHint('current2')">💡 ヒント</button>
                    </div>

                    <div id="current2-feedback" class="feedback"></div>
                </div>

                <div class="question-box" id="question3" style="display: none;">
                    <h3>❓ 問題3：法則を理解しよう</h3>
                    <p>これまでの計算から、どんな関係が見えてきましたか？</p>
                    
                    <div style="margin: 20px 0;">
                        <p><strong>選択してください：</strong></p>
                        <label style="display: block; margin: 10px 0;">
                            <input type="radio" name="relationship" value="1"> 電圧が大きくなると、電流は小さくなる
                        </label>
                        <label style="display: block; margin: 10px 0;">
                            <input type="radio" name="relationship" value="2"> 電圧が大きくなると、電流も大きくなる
                        </label>
                        <label style="display: block; margin: 10px 0;">
                            <input type="radio" name="relationship" value="3"> 電圧と電流は関係ない
                        </label>
                        <button class="check-button" onclick="checkAnswer('relationship')">確認</button>
                    </div>

                    <div id="relationship-feedback" class="feedback"></div>
                </div>

                <div class="theory-box" id="final-theory" style="display: none;">
                    <h3>🎉 オームの法則マスター！</h3>
                    <div class="formula-display">
                        <div class="main-formula">V = I × R</div>
                        <div class="sub-formula">I = V ÷ R</div>
                        <div class="sub-formula">R = V ÷ I</div>
                    </div>
                    <p>これがオームの法則です！3つの値のうち2つがわかれば、残りの1つを計算できます。</p>
                    <ul>
                        <li>電圧が大きくなると → 電流も大きくなる（抵抗が一定の場合）</li>
                        <li>抵抗が大きくなると → 電流は小さくなる（電圧が一定の場合）</li>
                    </ul>
                </div>
            </div>
        </div>
        </div>

        <!-- 直列回路タブ -->
        <div id="series-tab" class="tab-content">
            <div class="progress-indicator">
                <div class="progress-step active" id="series-step1">
                    <div class="circle">1</div>
                    <div>回路を観察</div>
                </div>
                <div class="progress-step" id="series-step2">
                    <div class="circle">2</div>
                    <div>合成抵抗を計算</div>
                </div>
                <div class="progress-step" id="series-step3">
                    <div class="circle">3</div>
                    <div>電流と電圧を理解</div>
                </div>
            </div>

            <div class="main-content">
                <div class="card">
                    <h2>🔗 直列回路の実験</h2>
                    
                    <div class="circuit-container">
                        <svg class="circuit-svg" viewBox="0 0 950 600" style="background: white;">
                            <!-- グラデーション定義はメインSVGから継承 -->
                            
                            <!-- 電池（SVGを直接定義） -->
                            <g transform="translate(50, 300) scale(1.3)">
                                <rect x="9" y="19" width="82" height="127" rx="3" ry="3" fill="#333333"/>
                                <rect x="10" y="20" width="80" height="15" fill="#D4AF37" rx="2" ry="2"/>
                                <rect x="10" y="35" width="80" height="95" fill="#003366"/>
                                <text x="50" y="125.5" fill="white" font-family="Arial, sans-serif" font-size="7" text-anchor="middle" font-weight="bold">12V</text>
                            </g>
                            
                            <!-- 電球1 -->
                            <g transform="translate(250, 50) scale(0.8)">
                                <circle cx="50" cy="55" r="30" fill="#FFE082" opacity="0.8"/>
                                <path d="M 50 20 C 30 20, 25 40, 30 60 C 35 80, 40 90, 45 90 L 55 90 C 60 90, 65 80, 70 60 C 75 40, 70 20, 50 20 Z" 
                                      fill="rgba(255, 248, 220, 0.5)" stroke="#F57C00" stroke-width="2"/>
                                <rect x="40" y="90" width="20" height="20" fill="#757575" rx="3"/>
                            </g>
                            <text x="290" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#005BAB" font-weight="bold">R₁ = 2Ω</text>
                            
                            <!-- 電球2 -->
                            <g transform="translate(450, 50) scale(0.8)">
                                <circle cx="50" cy="55" r="30" fill="#FFE082" opacity="0.8"/>
                                <path d="M 50 20 C 30 20, 25 40, 30 60 C 35 80, 40 90, 45 90 L 55 90 C 60 90, 65 80, 70 60 C 75 40, 70 20, 50 20 Z" 
                                      fill="rgba(255, 248, 220, 0.5)" stroke="#F57C00" stroke-width="2"/>
                                <rect x="40" y="90" width="20" height="20" fill="#757575" rx="3"/>
                            </g>
                            <text x="490" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#005BAB" font-weight="bold">R₂ = 3Ω</text>
                            
                            <!-- 電流計 -->
                            <circle cx="650" cy="200" r="40" fill="white" stroke="#333" stroke-width="3"/>
                            <text x="650" y="205" text-anchor="middle" font-size="24" font-weight="bold" fill="#005BAB">A</text>
                            <text x="650" y="260" text-anchor="middle" font-size="16" fill="#005BAB">電流計</text>
                            <text x="650" y="280" text-anchor="middle" font-size="20" font-weight="bold" fill="#FF961C" id="series-current-display">?A</text>
                            
                            <!-- 配線 -->
                            <g stroke-width="3" fill="none">
                                <path d="M 95.5 313 V 100 H 290" stroke="black" class="current-flow"/>
                                <path d="M 310 100 H 490" stroke="black" class="current-flow"/>
                                <path d="M 510 100 H 650 V 160" stroke="black" class="current-flow"/>
                                <path d="M 650 240 V 400 H 134.5 V 313" stroke="black" class="current-flow"/>
                            </g>
                            
                            <!-- 電圧表示 -->
                            <text x="115" y="280" text-anchor="middle" font-size="20" fill="#005BAB" font-weight="bold">12V</text>
                            
                            <!-- 電子の経路 -->
                            <path id="series-electron-path" d="M 95.5 313 V 100 H 290 L 310,100 L 490,100 L 510,100 L 650,100 V 240 L 650,400 H 134.5 V 313" fill="none"/>
                            
                            <!-- 電子グループ -->
                            <g id="electrons"></g>
                        </svg>
                    </div>
                </div>

                <div class="card">
                    <h2>📝 直列回路を理解しよう</h2>

                    <div class="theory-box">
                        <h3>🔍 直列回路の特徴</h3>
                        <ul>
                            <li>🔗 抵抗が一直線につながっている</li>
                            <li>⚡ 電流はどこでも同じ値</li>
                            <li>📊 抵抗は足し算で合成</li>
                            <li>🔋 電圧は各抵抗で分配される</li>
                        </ul>
                    </div>

                    <div class="question-box">
                        <h3>❓ 問題1：合成抵抗を求めよう</h3>
                        <p>R₁ = 2Ω、R₂ = 3Ω のとき、合成抵抗はいくつでしょうか？</p>
                        
                        <div class="formula-display">
                            <div class="main-formula">R合成 = R₁ + R₂</div>
                        </div>

                        <div class="input-group">
                            <label>合成抵抗：</label>
                            <input type="number" id="series-resistance-answer" placeholder="？" step="0.1">
                            <span>Ω（オーム）</span>
                            <button class="check-button" onclick="checkSeriesAnswer('resistance')">確認</button>
                            <button class="hint-button" onclick="showSeriesHint('resistance')">💡 ヒント</button>
                        </div>

                        <div id="series-resistance-feedback" class="feedback"></div>
                    </div>

                    <div class="question-box" id="series-question2" style="display: none;">
                        <h3>❓ 問題2：電流を求めよう</h3>
                        <p>電圧が12V、合成抵抗が5Ωのとき、電流は？</p>
                        
                        <div class="input-group">
                            <label>電流 (I)：</label>
                            <input type="number" id="series-current-answer" placeholder="？" step="0.1">
                            <span>A（アンペア）</span>
                            <button class="check-button" onclick="checkSeriesAnswer('current')">確認</button>
                        </div>

                        <div id="series-current-feedback" class="feedback"></div>
                    </div>

                    <div class="theory-box" id="series-final" style="display: none;">
                        <h3>🎉 直列回路マスター！</h3>
                        <div class="formula-display">
                            <div class="sub-formula">合成抵抗：R = R₁ + R₂ + R₃ + ...</div>
                            <div class="sub-formula">電流：I = V ÷ R（どこでも同じ）</div>
                            <div class="sub-formula">各抵抗の電圧：V₁ = I × R₁</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 並列回路タブ -->
        <div id="parallel-tab" class="tab-content">
            <div class="progress-indicator">
                <div class="progress-step active" id="parallel-step1">
                    <div class="circle">1</div>
                    <div>回路を観察</div>
                </div>
                <div class="progress-step" id="parallel-step2">
                    <div class="circle">2</div>
                    <div>合成抵抗を計算</div>
                </div>
                <div class="progress-step" id="parallel-step3">
                    <div class="circle">3</div>
                    <div>電流の分配を理解</div>
                </div>
            </div>

            <div class="main-content">
                <div class="card">
                    <h2>⚡ 並列回路の実験</h2>
                    
                    <div class="circuit-container">
                        <svg class="circuit-svg" viewBox="0 0 950 600" style="background: white;">
                            <!-- 電池 -->
                            <g transform="translate(50, 300) scale(1.3)">
                                <rect x="9" y="19" width="82" height="127" rx="3" ry="3" fill="#333333"/>
                                <rect x="10" y="20" width="80" height="15" fill="#D4AF37" rx="2" ry="2"/>
                                <rect x="10" y="35" width="80" height="95" fill="#003366"/>
                                <text x="50" y="125.5" fill="white" font-family="Arial, sans-serif" font-size="7" text-anchor="middle" font-weight="bold">12V</text>
                            </g>
                            
                            <!-- 電球1（上の経路） -->
                            <g transform="translate(350, 50) scale(0.8)">
                                <circle cx="50" cy="55" r="30" fill="#FFE082" opacity="0.8"/>
                                <path d="M 50 20 C 30 20, 25 40, 30 60 C 35 80, 40 90, 45 90 L 55 90 C 60 90, 65 80, 70 60 C 75 40, 70 20, 50 20 Z" 
                                      fill="rgba(255, 248, 220, 0.5)" stroke="#F57C00" stroke-width="2"/>
                                <rect x="40" y="90" width="20" height="20" fill="#757575" rx="3"/>
                            </g>
                            <text x="390" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#005BAB" font-weight="bold">R₁ = 6Ω</text>
                            
                            <!-- 電球2（下の経路） -->
                            <g transform="translate(350, 250) scale(0.8)">
                                <circle cx="50" cy="55" r="30" fill="#FFE082" opacity="0.8"/>
                                <path d="M 50 20 C 30 20, 25 40, 30 60 C 35 80, 40 90, 45 90 L 55 90 C 60 90, 65 80, 70 60 C 75 40, 70 20, 50 20 Z" 
                                      fill="rgba(255, 248, 220, 0.5)" stroke="#F57C00" stroke-width="2"/>
                                <rect x="40" y="90" width="20" height="20" fill="#757575" rx="3"/>
                            </g>
                            <text x="390" y="240" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#005BAB" font-weight="bold">R₂ = 3Ω</text>
                            
                            <!-- 電流計（メイン） -->
                            <circle cx="650" cy="200" r="40" fill="white" stroke="#333" stroke-width="3"/>
                            <text x="650" y="205" text-anchor="middle" font-size="24" font-weight="bold" fill="#005BAB">A</text>
                            <text x="650" y="260" text-anchor="middle" font-size="16" fill="#005BAB">総電流</text>
                            <text x="650" y="280" text-anchor="middle" font-size="20" font-weight="bold" fill="#FF961C" id="parallel-current-display">?A</text>
                            
                            <!-- 配線 -->
                            <g stroke-width="3" fill="none">
                                <!-- メイン配線 -->
                                <path d="M 95.5 313 V 200 H 250" stroke="black" class="current-flow"/>
                                <!-- 分岐上 -->
                                <path d="M 250 200 V 100 H 390" stroke="black" class="current-flow"/>
                                <path d="M 410 100 H 550 V 200" stroke="black" class="current-flow"/>
                                <!-- 分岐下 -->
                                <path d="M 250 200 V 300 H 390" stroke="black" class="current-flow"/>
                                <path d="M 410 300 H 550 V 200" stroke="black" class="current-flow"/>
                                <!-- 合流後 -->
                                <path d="M 550 200 H 610" stroke="black" class="current-flow"/>
                                <path d="M 690 200 H 750 V 400 H 134.5 V 313" stroke="black" class="current-flow"/>
                            </g>
                            
                            <!-- 電圧表示 -->
                            <text x="115" y="280" text-anchor="middle" font-size="20" fill="#005BAB" font-weight="bold">12V</text>
                            
                            <!-- 電子の経路（上の経路） -->
                            <path id="parallel-electron-path1" d="M 95.5 313 V 200 H 250 V 100 H 390 L 410,100 H 550 V 200 H 610 L 690,200 H 750 V 400 H 134.5 V 313" fill="none"/>
                            
                            <!-- 電子の経路（下の経路） -->
                            <path id="parallel-electron-path2" d="M 95.5 313 V 200 H 250 V 300 H 390 L 410,300 H 550 V 200 H 610 L 690,200 H 750 V 400 H 134.5 V 313" fill="none"/>
                            
                            <!-- 電子グループ -->
                            <g id="electrons"></g>
                        </svg>
                    </div>
                </div>

                <div class="card">
                    <h2>📝 並列回路を理解しよう</h2>

                    <div class="theory-box">
                        <h3>🔍 並列回路の特徴</h3>
                        <ul>
                            <li>🔀 抵抗が並んでつながっている</li>
                            <li>🔋 電圧はどこでも同じ値</li>
                            <li>⚡ 電流は各経路に分配される</li>
                            <li>📊 合成抵抗は元の抵抗より小さくなる</li>
                        </ul>
                    </div>

                    <div class="question-box">
                        <h3>❓ 問題1：合成抵抗を求めよう</h3>
                        <p>R₁ = 6Ω、R₂ = 3Ω のとき、合成抵抗はいくつでしょうか？</p>
                        
                        <div class="formula-display">
                            <div class="main-formula">1/R合成 = 1/R₁ + 1/R₂</div>
                            <div class="sub-formula">または R合成 = (R₁ × R₂) ÷ (R₁ + R₂)</div>
                        </div>

                        <div class="input-group">
                            <label>合成抵抗：</label>
                            <input type="number" id="parallel-resistance-answer" placeholder="？" step="0.1">
                            <span>Ω（オーム）</span>
                            <button class="check-button" onclick="checkParallelAnswer('resistance')">確認</button>
                            <button class="hint-button" onclick="showParallelHint('resistance')">💡 ヒント</button>
                        </div>

                        <div id="parallel-resistance-feedback" class="feedback"></div>
                    </div>

                    <div class="question-box" id="parallel-question2" style="display: none;">
                        <h3>❓ 問題2：総電流を求めよう</h3>
                        <p>電圧が12V、合成抵抗が2Ωのとき、総電流は？</p>
                        
                        <div class="input-group">
                            <label>総電流 (I)：</label>
                            <input type="number" id="parallel-current-answer" placeholder="？" step="0.1">
                            <span>A（アンペア）</span>
                            <button class="check-button" onclick="checkParallelAnswer('current')">確認</button>
                        </div>

                        <div id="parallel-current-feedback" class="feedback"></div>
                    </div>

                    <div class="theory-box" id="parallel-final" style="display: none;">
                        <h3>🎉 並列回路マスター！</h3>
                        <div class="formula-display">
                            <div class="sub-formula">合成抵抗：1/R = 1/R₁ + 1/R₂ + ...</div>
                            <div class="sub-formula">電圧：V = 一定（どこでも同じ）</div>
                            <div class="sub-formula">各経路の電流：I₁ = V ÷ R₁</div>
                            <div class="sub-formula">総電流：I = I₁ + I₂ + ...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // タブ切り替え機能
        function switchTab(tabName) {
            // すべてのタブコンテンツを非表示
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // すべてのタブボタンから active クラスを削除
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // 選択されたタブを表示
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // 選択されたボタンに active クラスを追加
            event.target.classList.add('active');
            
            // 既存の電子をクリア
            electrons.forEach(e => e.element.remove());
            electrons = [];
            
            // タブに応じて電子を作成
            setTimeout(() => {
                if (tabName === 'basic') {
                    for (let i = 0; i < 6; i++) {
                        createElectron('#electron-path');
                    }
                } else if (tabName === 'series') {
                    for (let i = 0; i < 5; i++) {
                        createElectron('#series-electron-path');
                    }
                } else if (tabName === 'parallel') {
                    // 並列回路では両方の経路に電子を配置
                    for (let i = 0; i < 4; i++) {
                        createElectron('#parallel-electron-path1');
                    }
                    for (let i = 0; i < 8; i++) {
                        createElectron('#parallel-electron-path2');
                    }
                } else if (tabName === 'composite') {
                    // 合成抵抗タブが選択されたときの初期化
                    updateCompositeCircuit();
                }
                // comparison タブでは電子アニメーションなし
            }, 100);
        }

        // 電子のアニメーション管理
        let electronSpeed = 2;
        let electrons = [];
        
        function createElectron(pathId = '#electron-path') {
            const activeTab = document.querySelector('.tab-content.active');
            const svg = activeTab.querySelector('.circuit-svg');
            const electronGroup = svg.querySelector('#electrons') || createElectronGroup(svg);
            
            const electron = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            electron.setAttribute('r', '5');
            electron.setAttribute('fill', '#FF961C');
            electron.setAttribute('filter', 'drop-shadow(0 0 5px rgba(255,150,28,0.8))');
            
            const animateMotion = document.createElementNS('http://www.w3.org/2000/svg', 'animateMotion');
            animateMotion.setAttribute('dur', `${4 / electronSpeed}s`);
            animateMotion.setAttribute('repeatCount', 'indefinite');
            animateMotion.setAttribute('begin', `${Math.random() * 4}s`);
            
            const mpath = document.createElementNS('http://www.w3.org/2000/svg', 'mpath');
            mpath.setAttributeNS('http://www.w3.org/1999/xlink', 'href', pathId);
            
            animateMotion.appendChild(mpath);
            electron.appendChild(animateMotion);
            
            electronGroup.appendChild(electron);
            electrons.push({element: electron, animation: animateMotion});
        }
        
        function createElectronGroup(svg) {
            const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            group.setAttribute('id', 'electrons');
            svg.appendChild(group);
            return group;
        }

        // 初期電子を作成（基本回路用）
        setTimeout(() => {
            for (let i = 0; i < 6; i++) {
                createElectron();
            }
        }, 100);

        // スライダーで電子の速度を調整
        const speedSlider = document.getElementById('speed-slider');
        if (speedSlider) {
            const speedDisplay = document.getElementById('speed-display');
            
            speedSlider.addEventListener('input', function() {
                electronSpeed = parseFloat(this.value);
                const speedLabels = ['とても遅い', '遅い', '通常', '速い', 'とても速い'];
                const index = Math.floor((electronSpeed - 0.5) / 0.9);
                speedDisplay.textContent = speedLabels[Math.min(index, speedLabels.length - 1)];
                
                // 電子の速度を更新
                electrons.forEach(e => {
                    e.animation.setAttribute('dur', `${4 / electronSpeed}s`);
                });
            });
        }

        // タブ切り替え機能
        function switchTab(tabName) {
            // すべてのタブコンテンツを非表示
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // すべてのタブボタンから active クラスを削除
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // 選択されたタブを表示
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // 選択されたボタンに active クラスを追加
            event.target.classList.add('active');
            
            // 既存の電子をクリア
            electrons.forEach(e => e.element.remove());
            electrons = [];
            
            // タブに応じて電子を作成
            setTimeout(() => {
                if (tabName === 'basic') {
                    for (let i = 0; i < 6; i++) {
                        createElectron('#electron-path');
                    }
                } else if (tabName === 'series') {
                    for (let i = 0; i < 5; i++) {
                        createElectron('#series-electron-path');
                    }
                } else if (tabName === 'parallel') {
                    // 並列回路では両方の経路に電子を配置
                    for (let i = 0; i < 4; i++) {
                        createElectron('#parallel-electron-path1');
                    }
                    for (let i = 0; i < 8; i++) {
                        createElectron('#parallel-electron-path2');
                    }
                } else if (tabName === 'composite') {
                    // 合成抵抗タブが選択されたときの初期化
                    updateCompositeCircuit();
                }
                // comparison タブでは電子アニメーションなし
            }, 100);
        }

        // 直列回路の答えチェック
        function checkSeriesAnswer(type) {
            if (type === 'resistance') {
                const answer = parseFloat(document.getElementById('series-resistance-answer').value);
                const feedback = document.getElementById('series-resistance-feedback');
                
                if (answer === 5) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = '🎉 正解です！ 2Ω + 3Ω = 5Ω です！';
                    feedback.style.display = 'block';
                    
                    setTimeout(() => {
                        document.getElementById('series-question2').style.display = 'block';
                        document.getElementById('series-step1').classList.remove('active');
                        document.getElementById('series-step1').classList.add('completed');
                        document.getElementById('series-step2').classList.add('active');
                    }, 1500);
                } else if (answer) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '❌ もう一度計算してみましょう。直列回路では抵抗を足します。';
                    feedback.style.display = 'block';
                }
            } else if (type === 'current') {
                const answer = parseFloat(document.getElementById('series-current-answer').value);
                const feedback = document.getElementById('series-current-feedback');
                
                if (answer === 2.4) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = '🎉 正解です！ 12V ÷ 5Ω = 2.4A です！';
                    feedback.style.display = 'block';
                    
                    document.getElementById('series-current-display').textContent = '2.4A';
                    
                    setTimeout(() => {
                        document.getElementById('series-final').style.display = 'block';
                        document.getElementById('series-step2').classList.remove('active');
                        document.getElementById('series-step2').classList.add('completed');
                        document.getElementById('series-step3').classList.add('active');
                    }, 1500);
                } else if (answer) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '❌ もう一度計算してみましょう。I = V ÷ R です。';
                    feedback.style.display = 'block';
                }
            }
        }

        // 並列回路の答えチェック
        function checkParallelAnswer(type) {
            if (type === 'resistance') {
                const answer = parseFloat(document.getElementById('parallel-resistance-answer').value);
                const feedback = document.getElementById('parallel-resistance-feedback');
                
                if (answer === 2) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = '🎉 正解です！ (6 × 3) ÷ (6 + 3) = 18 ÷ 9 = 2Ω です！';
                    feedback.style.display = 'block';
                    
                    setTimeout(() => {
                        document.getElementById('parallel-question2').style.display = 'block';
                        document.getElementById('parallel-step1').classList.remove('active');
                        document.getElementById('parallel-step1').classList.add('completed');
                        document.getElementById('parallel-step2').classList.add('active');
                    }, 1500);
                } else if (answer) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '❌ もう一度計算してみましょう。(R₁ × R₂) ÷ (R₁ + R₂) を使ってみてください。';
                    feedback.style.display = 'block';
                }
            } else if (type === 'current') {
                const answer = parseFloat(document.getElementById('parallel-current-answer').value);
                const feedback = document.getElementById('parallel-current-feedback');
                
                if (answer === 6) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = '🎉 正解です！ 12V ÷ 2Ω = 6A です！';
                    feedback.style.display = 'block';
                    
                    document.getElementById('parallel-current-display').textContent = '6A';
                    
                    setTimeout(() => {
                        document.getElementById('parallel-final').style.display = 'block';
                        document.getElementById('parallel-step2').classList.remove('active');
                        document.getElementById('parallel-step2').classList.add('completed');
                        document.getElementById('parallel-step3').classList.add('active');
                    }, 1500);
                } else if (answer) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '❌ もう一度計算してみましょう。I = V ÷ R です。';
                    feedback.style.display = 'block';
                }
            }
        }

        // ヒント機能（直列回路）
        function showSeriesHint(type) {
            if (type === 'resistance') {
                const feedback = document.getElementById('series-resistance-feedback');
                feedback.className = 'feedback hint';
                feedback.innerHTML = '💡 ヒント：直列回路では抵抗を足し算します。2 + 3 = ?';
                feedback.style.display = 'block';
            }
        }

        // ヒント機能（並列回路）
        function showParallelHint(type) {
            if (type === 'resistance') {
                const feedback = document.getElementById('parallel-resistance-feedback');
                feedback.className = 'feedback hint';
                feedback.innerHTML = '💡 ヒント：(6 × 3) ÷ (6 + 3) = 18 ÷ 9 = ?';
                feedback.style.display = 'block';
            }
        }

        // 答えのチェック機能
        function checkAnswer(type) {
            if (type === 'current') {
                const answer = parseFloat(document.getElementById('current-answer').value);
                const feedback = document.getElementById('current-feedback');
                
                if (answer === 3) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = '🎉 正解です！ 9V ÷ 3Ω = 3A です！';
                    feedback.style.display = 'block';
                    
                    // 電流計の表示を更新
                    document.getElementById('current-display').textContent = '3A';
                    
                    // 次の問題を表示
                    setTimeout(() => {
                        document.getElementById('question2').style.display = 'block';
                        document.getElementById('step1').classList.remove('active');
                        document.getElementById('step1').classList.add('completed');
                        document.getElementById('step2').classList.add('active');
                    }, 1500);
                } else if (answer) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '❌ もう一度計算してみましょう。V = I × R を I = ... の形に変形してみてください。';
                    feedback.style.display = 'block';
                }
            } else if (type === 'current2') {
                const answer = parseFloat(document.getElementById('current-answer2').value);
                const feedback = document.getElementById('current2-feedback');
                
                if (answer === 4) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = '🎉 正解です！ 12V ÷ 3Ω = 4A です！電圧が増えると電流も増えますね！';
                    feedback.style.display = 'block';
                    
                    // 次の問題を表示
                    setTimeout(() => {
                        document.getElementById('question3').style.display = 'block';
                    }, 1500);
                } else if (answer) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '❌ もう一度計算してみましょう。12V ÷ 3Ω = ?';
                    feedback.style.display = 'block';
                }
            } else if (type === 'relationship') {
                const selected = document.querySelector('input[name="relationship"]:checked');
                const feedback = document.getElementById('relationship-feedback');
                
                if (selected && selected.value === '2') {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = '🎉 正解です！抵抗が一定のとき、電圧と電流は比例関係にあります！';
                    feedback.style.display = 'block';
                    
                    // 最終説明を表示
                    setTimeout(() => {
                        document.getElementById('final-theory').style.display = 'block';
                        document.getElementById('step2').classList.remove('active');
                        document.getElementById('step2').classList.add('completed');
                        document.getElementById('step3').classList.add('active');
                    }, 1500);
                } else if (selected) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '❌ 9V→3A、12V→4A の結果を比べてみてください。';
                    feedback.style.display = 'block';
                }
            }
        }

        // ヒント機能
        function showHint(type) {
            if (type === 'current') {
                const feedback = document.getElementById('current-feedback');
                feedback.className = 'feedback hint';
                feedback.innerHTML = '💡 ヒント：V = I × R を変形すると... I = V ÷ R になります。9 ÷ 3 = ?';
                feedback.style.display = 'block';
            } else if (type === 'current2') {
                const feedback = document.getElementById('current2-feedback');
                feedback.className = 'feedback hint';
                feedback.innerHTML = '💡 ヒント：同じ公式を使います。I = V ÷ R で、12 ÷ 3 = ?';
                feedback.style.display = 'block';
            }
        }

        // 最終問題のチェック
        function checkFinalAnswer() {
            const selected = document.querySelector('input[name="final-answer"]:checked');
            const feedback = document.getElementById('final-feedback');
            
            if (selected && selected.value === 'parallel') {
                feedback.className = 'feedback correct';
                feedback.innerHTML = '🎉 正解です！並列接続では各電球に同じ電圧（12V）がかかり、合成抵抗が最も小さくなるため、電流が最大になり最も明るく光ります！<br><br>直列：合成抵抗18Ω → 電流0.67A<br>並列：合成抵抗2Ω → 電流6A（各電球2A）';
                feedback.style.display = 'block';
            } else if (selected) {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = '❌ もう一度考えてみましょう。電球の明るさは流れる電流の大きさで決まります。どの接続方法が最も大きな電流を流せるでしょうか？';
                feedback.style.display = 'block';
            }
        }

        // ページロード時のアニメーション
        window.addEventListener('load', () => {
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 200);
            });
        });

        // 合成抵抗計算機の関数
        function updateCompositeCircuit() {
            const circuitType = document.getElementById('circuit-type').value;
            const r1 = parseFloat(document.getElementById('r1-input').value) || 100;
            const r2 = parseFloat(document.getElementById('r2-input').value) || 200;
            const r3 = parseFloat(document.getElementById('r3-input').value) || 300;
            
            let compositeResistance;
            let explanation;
            
            if (circuitType === 'series') {
                compositeResistance = r1 + r2 + r3;
                explanation = `直列回路の計算過程：<br>
                R = R₁ + R₂ + R₃<br>
                R = ${r1}Ω + ${r2}Ω + ${r3}Ω<br>
                R = ${compositeResistance}Ω`;
                drawSeriesCircuit(r1, r2, r3);
            } else {
                const reciprocalSum = 1/r1 + 1/r2 + 1/r3;
                compositeResistance = 1 / reciprocalSum;
                explanation = `並列回路の計算過程：<br>
                1/R = 1/R₁ + 1/R₂ + 1/R₃<br>
                1/R = 1/${r1} + 1/${r2} + 1/${r3}<br>
                1/R = ${reciprocalSum.toFixed(6)}<br>
                R = ${compositeResistance.toFixed(2)}Ω`;
                drawParallelCircuit(r1, r2, r3);
            }
            
            document.getElementById('composite-result').innerHTML = 
                `合成抵抗: <span style="color: var(--accent-color);">${compositeResistance.toFixed(2)}Ω</span>`;
            document.getElementById('composite-explanation').innerHTML = explanation;
        }

        function drawSeriesCircuit(r1, r2, r3) {
            const svg = document.getElementById('composite-circuit');
            svg.innerHTML = `
                <defs>
                    <linearGradient id="batteryGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#FFA500;stop-opacity:1" />
                    </linearGradient>
                </defs>
                
                <!-- 電源 -->
                <rect x="50" y="350" width="80" height="50" fill="url(#batteryGrad)" stroke="#333" stroke-width="2" rx="5"/>
                <text x="90" y="380" text-anchor="middle" font-size="14" font-weight="bold">9V</text>
                
                <!-- 抵抗1 -->
                <rect x="200" y="360" width="100" height="30" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2" rx="5"/>
                <text x="250" y="380" text-anchor="middle" font-size="12" font-weight="bold" fill="#2E7D32">R₁=${r1}Ω</text>
                
                <!-- 抵抗2 -->
                <rect x="350" y="360" width="100" height="30" fill="#FFF3E0" stroke="#FF9800" stroke-width="2" rx="5"/>
                <text x="400" y="380" text-anchor="middle" font-size="12" font-weight="bold" fill="#E65100">R₂=${r2}Ω</text>
                
                <!-- 抵抗3 -->
                <rect x="500" y="360" width="100" height="30" fill="#E3F2FD" stroke="#2196F3" stroke-width="2" rx="5"/>
                <text x="550" y="380" text-anchor="middle" font-size="12" font-weight="bold" fill="#0D47A1">R₃=${r3}Ω</text>
                
                <!-- 配線 -->
                <line x1="130" y1="375" x2="200" y2="375" stroke="#333" stroke-width="3"/>
                <line x1="300" y1="375" x2="350" y2="375" stroke="#333" stroke-width="3"/>
                <line x1="450" y1="375" x2="500" y2="375" stroke="#333" stroke-width="3"/>
                <line x1="600" y1="375" x2="700" y2="375" stroke="#333" stroke-width="3"/>
                <line x1="700" y1="375" x2="700" y2="500" stroke="#333" stroke-width="3"/>
                <line x1="700" y1="500" x2="50" y2="500" stroke="#333" stroke-width="3"/>
                <line x1="50" y1="500" x2="50" y2="400" stroke="#333" stroke-width="3"/>
                
                <!-- 電流矢印 -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#FF6B6B" />
                    </marker>
                </defs>
                <line x1="165" y1="355" x2="185" y2="355" stroke="#FF6B6B" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="175" y="345" text-anchor="middle" font-size="12" fill="#FF6B6B" font-weight="bold">I</text>
            `;
        }

        function drawParallelCircuit(r1, r2, r3) {
            const svg = document.getElementById('composite-circuit');
            svg.innerHTML = `
                <defs>
                    <linearGradient id="batteryGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#FFA500;stop-opacity:1" />
                    </linearGradient>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#FF6B6B" />
                    </marker>
                </defs>
                
                <!-- 電源 -->
                <rect x="50" y="350" width="80" height="50" fill="url(#batteryGrad)" stroke="#333" stroke-width="2" rx="5"/>
                <text x="90" y="380" text-anchor="middle" font-size="14" font-weight="bold">9V</text>
                
                <!-- 抵抗1 -->
                <rect x="300" y="280" width="100" height="30" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2" rx="5"/>
                <text x="350" y="300" text-anchor="middle" font-size="12" font-weight="bold" fill="#2E7D32">R₁=${r1}Ω</text>
                
                <!-- 抵抗2 -->
                <rect x="300" y="360" width="100" height="30" fill="#FFF3E0" stroke="#FF9800" stroke-width="2" rx="5"/>
                <text x="350" y="380" text-anchor="middle" font-size="12" font-weight="bold" fill="#E65100">R₂=${r2}Ω</text>
                
                <!-- 抵抗3 -->
                <rect x="300" y="440" width="100" height="30" fill="#E3F2FD" stroke="#2196F3" stroke-width="2" rx="5"/>
                <text x="350" y="460" text-anchor="middle" font-size="12" font-weight="bold" fill="#0D47A1">R₃=${r3}Ω</text>
                
                <!-- 配線 -->
                <!-- 左側の共通線 -->
                <line x1="130" y1="375" x2="200" y2="375" stroke="#333" stroke-width="3"/>
                <line x1="200" y1="295" x2="200" y2="455" stroke="#333" stroke-width="3"/>
                <line x1="200" y1="295" x2="300" y2="295" stroke="#333" stroke-width="3"/>
                <line x1="200" y1="375" x2="300" y2="375" stroke="#333" stroke-width="3"/>
                <line x1="200" y1="455" x2="300" y2="455" stroke="#333" stroke-width="3"/>
                
                <!-- 右側の共通線 -->
                <line x1="400" y1="295" x2="500" y2="295" stroke="#333" stroke-width="3"/>
                <line x1="400" y1="375" x2="500" y2="375" stroke="#333" stroke-width="3"/>
                <line x1="400" y1="455" x2="500" y2="455" stroke="#333" stroke-width="3"/>
                <line x1="500" y1="295" x2="500" y2="455" stroke="#333" stroke-width="3"/>
                <line x1="500" y1="375" x2="600" y2="375" stroke="#333" stroke-width="3"/>
                
                <!-- 電源への戻り線 -->
                <line x1="600" y1="375" x2="600" y2="500" stroke="#333" stroke-width="3"/>
                <line x1="600" y1="500" x2="50" y2="500" stroke="#333" stroke-width="3"/>
                <line x1="50" y1="500" x2="50" y2="400" stroke="#333" stroke-width="3"/>
                
                <!-- 電流矢印 -->
                <line x1="165" y1="355" x2="185" y2="355" stroke="#FF6B6B" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="175" y="345" text-anchor="middle" font-size="12" fill="#FF6B6B" font-weight="bold">I</text>
                
                <line x1="270" y1="275" x2="285" y2="275" stroke="#FF6B6B" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="277" y="265" text-anchor="middle" font-size="10" fill="#FF6B6B">I₁</text>
                
                <line x1="270" y1="355" x2="285" y2="355" stroke="#FF6B6B" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="277" y="345" text-anchor="middle" font-size="10" fill="#FF6B6B">I₂</text>
                
                <line x1="270" y1="435" x2="285" y2="435" stroke="#FF6B6B" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="277" y="425" text-anchor="middle" font-size="10" fill="#FF6B6B">I₃</text>
            `;
        }

        // ページ読み込み時に合成抵抗を初期化
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                updateCompositeCircuit();
            }, 100);
        });
    </script>
</body>
</html>
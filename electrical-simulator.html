<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電気工学基礎インタラクティブシミュレーター</title>
    <style>
        :root {
            --primary-color: #005BAB;
            --secondary-color: #FF961C;
            --light-blue: #E0EEF9;
            --medium-blue: #4D8BC9;
            --neutral-grey: #F5F5F5;
            --dark-grey: #616161;
            --text-dark: #333333;
            --text-light: #FFFFFF;
            --success-color: #4CAF50;
            --warning-color: #FFC107;
            --danger-color: #F44336;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Meiryo, "Hiragino Kaku Gothic Pro", sans-serif;
            background-color: #f0f4f8;
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--medium-blue) 100%);
            color: var(--text-light);
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            z-index: 1;
            position: relative;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            z-index: 1;
            position: relative;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
            background: white;
            padding: 0.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }
        
        .tab-button {
            background: none;
            border: none;
            padding: 1rem 2rem;
            margin: 0.25rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark-grey);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .tab-button::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: var(--secondary-color);
            transition: width 0.3s ease;
        }
        
        .tab-button:hover {
            background: var(--light-blue);
            transform: translateY(-2px);
        }
        
        .tab-button.active {
            background: var(--primary-color);
            color: white;
        }
        
        .tab-button.active::before {
            width: 100%;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        
        .control-group {
            margin: 1.5rem 0;
            padding: 1rem;
            background: var(--neutral-grey);
            border-radius: 8px;
        }
        
        .control-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 0.5rem 0;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--secondary-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 0 8px rgba(255,150,28,0.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--secondary-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .value-display {
            min-width: 80px;
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            color: white;
            border-radius: 6px;
            font-weight: 600;
            text-align: center;
        }
        
        select {
            padding: 0.75rem;
            border: 2px solid var(--primary-color);
            border-radius: 6px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        select:hover {
            border-color: var(--secondary-color);
        }
        
        select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0,91,171,0.2);
        }
        
        .result-box {
            background: linear-gradient(135deg, var(--light-blue) 0%, white 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            border: 2px solid var(--primary-color);
        }
        
        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 0.5rem 0;
        }
        
        .formula {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
            border-left: 4px solid var(--secondary-color);
        }
        
        .svg-container {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
        }
        
        .comparison-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .comparison-item {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        
        .comparison-item:hover {
            border-color: var(--primary-color);
            transform: scale(1.02);
        }
        
        .comparison-item h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-good {
            background: var(--success-color);
            box-shadow: 0 0 10px rgba(76,175,80,0.5);
        }
        
        .status-warning {
            background: var(--warning-color);
            box-shadow: 0 0 10px rgba(255,193,7,0.5);
        }
        
        .status-danger {
            background: var(--danger-color);
            box-shadow: 0 0 10px rgba(244,67,54,0.5);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            color: var(--primary-color);
            cursor: help;
            text-decoration: underline dotted;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 8px;
            padding: 12px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .interactive-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem;
        }
        
        .interactive-button:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,150,28,0.3);
        }
        
        .alert {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            display: flex;
            align-items: center;
        }
        
        .alert-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
        }
        
        .alert-warning {
            background: #fff3e0;
            border: 1px solid #ff9800;
            color: #e65100;
        }
        
        .alert-danger {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #b71c1c;
        }
        
        .comparison-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 12px rgba(0,0,0,0.15);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .comparison-panel.active {
            right: 0;
        }
        
        .comparison-header {
            background: var(--primary-color);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .comparison-content {
            padding: 1rem;
        }
        
        .saved-result {
            background: var(--light-blue);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            position: relative;
        }
        
        .delete-result {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
        }
        
        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; transform: translate(-50%, -20px); }
        }
        
        @media (max-width: 768px) {
            .comparison-panel {
                width: 100%;
            }
            .container {
                padding: 1rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .tabs {
                padding: 0.25rem;
            }
            
            .tab-button {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .card {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>⚡ 電気工学基礎インタラクティブシミュレーター</h1>
        <p class="subtitle">初心者でも楽しく学べる電力・電圧・電流の世界</p>
    </header>
    
    <div class="container">
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('power-factor')">電力と力率</button>
            <button class="tab-button" onclick="showTab('voltage-drop')">電圧降下計算</button>
            <button class="tab-button" onclick="showTab('allowable-current')">電線の許容電流</button>
            <button class="tab-button" onclick="showTab('distribution-system')">配電方式比較</button>
        </div>
    
    <!-- 比較パネル -->
    <div id="comparison-panel" class="comparison-panel">
        <div class="comparison-header">
            <h3>📊 保存した計算結果</h3>
            <button onclick="toggleComparisonPanel()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">×</button>
        </div>
        <div class="comparison-content" id="saved-results">
            <p style="text-align: center; color: #999;">保存された結果がありません</p>
        </div>
    </div>
    
    <!-- 比較ボタン -->
    <button onclick="toggleComparisonPanel()" style="position: fixed; right: 20px; bottom: 20px; background: var(--secondary-color); color: white; border: none; padding: 1rem; border-radius: 50%; width: 60px; height: 60px; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: all 0.3s ease;">
        📊
    </button>
        
        <!-- 電力と力率タブ -->
        <div id="power-factor" class="tab-content active">
            <div class="card">
                <h2>📊 電力と力率の関係</h2>
                
                <div class="alert alert-info" style="margin-bottom: 1.5rem;">
                    <h4>🔍 基本概念の理解</h4>
                    <p><strong>電力には3種類あります：</strong></p>
                    <ul style="margin: 0.5rem 0;">
                        <li><strong>有効電力（P）</strong>：実際に仕事をする電力。単位は W（ワット）</li>
                        <li><strong>無効電力（Q）</strong>：磁界を作るだけで仕事をしない電力。単位は var（バール）</li>
                        <li><strong>皮相電力（S）</strong>：電線を流れる全体の電力。単位は VA（ボルトアンペア）</li>
                    </ul>
                    <p style="margin-top: 0.5rem;">これらは「力率三角形」という直角三角形の関係にあります。</p>
                </div>
                
                <div class="control-group">
                    <label class="control-label">電圧 (V)</label>
                    <div class="slider-container">
                        <input type="range" id="voltage-pf" min="100" max="500" value="200" step="10" onchange="updatePowerFactor()">
                        <span class="value-display" id="voltage-pf-value">200V</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">電流 (A)</label>
                    <div class="slider-container">
                        <input type="range" id="current-pf" min="1" max="100" value="50" step="1" onchange="updatePowerFactor()">
                        <span class="value-display" id="current-pf-value">50A</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">力率 (cosθ)</label>
                    <div class="slider-container">
                        <input type="range" id="power-factor" min="0" max="100" value="85" step="1" onchange="updatePowerFactor()">
                        <span class="value-display" id="power-factor-value">0.85</span>
                    </div>
                </div>
                
                <div class="svg-container">
                    <svg id="power-triangle" width="600" height="400" viewBox="0 0 600 400">
                        <!-- 力率三角形 -->
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
                            </marker>
                        </defs>
                        
                        <!-- 背景グリッド -->
                        <g opacity="0.2">
                            <line x1="50" y1="300" x2="550" y2="300" stroke="#ddd" stroke-width="1"/>
                            <line x1="100" y1="50" x2="100" y2="350" stroke="#ddd" stroke-width="1"/>
                        </g>
                        
                        <!-- 力率三角形 -->
                        <g id="triangle-group">
                            <!-- 有効電力 (横) -->
                            <line x1="100" y1="300" x2="400" y2="300" stroke="#4CAF50" stroke-width="4" marker-end="url(#arrowhead)"/>
                            <text x="250" y="320" text-anchor="middle" font-size="16" font-weight="bold" fill="#4CAF50">有効電力 P</text>
                            <text x="250" y="340" text-anchor="middle" font-size="14" id="active-power-text">8500W</text>
                            
                            <!-- 無効電力 (縦) -->
                            <line x1="400" y1="300" x2="400" y2="200" stroke="#FF9800" stroke-width="4" marker-end="url(#arrowhead)"/>
                            <text x="430" y="250" font-size="16" font-weight="bold" fill="#FF9800">無効電力 Q</text>
                            <text x="430" y="270" font-size="14" id="reactive-power-text">5268var</text>
                            
                            <!-- 皮相電力 (斜辺) -->
                            <line x1="100" y1="300" x2="400" y2="200" stroke="#2196F3" stroke-width="4" marker-end="url(#arrowhead)"/>
                            <text x="200" y="240" font-size="16" font-weight="bold" fill="#2196F3" transform="rotate(-18 200 240)">皮相電力 S</text>
                            <text x="200" y="260" font-size="14" id="apparent-power-text" transform="rotate(-18 200 260)">10000VA</text>
                            
                            <!-- 角度表示 -->
                            <path d="M 150 300 A 50 50 0 0 0 173 266" fill="none" stroke="#FF961C" stroke-width="2"/>
                            <text x="170" y="290" font-size="14" fill="#FF961C" id="angle-text">θ=31.8°</text>
                        </g>
                    </svg>
                </div>
                
                <div class="result-box">
                    <h3>計算結果</h3>
                    <div class="formula">
                        S² = P² + Q² （ピタゴラスの定理）
                    </div>
                    <p><strong>有効電力 (P):</strong> <span class="result-value" id="active-power">8,500 W</span></p>
                    <p><strong>無効電力 (Q):</strong> <span class="result-value" id="reactive-power">5,268 var</span></p>
                    <p><strong>皮相電力 (S):</strong> <span class="result-value" id="apparent-power">10,000 VA</span></p>
                    <p><strong>位相角 (θ):</strong> <span class="result-value" id="phase-angle">31.8°</span></p>
                    <button class="interactive-button" onclick="savePowerFactorResult()">📊 結果を保存</button>
                </div>
                
                <div class="card" style="background: #f8f9fa;">
                    <h3>📚 実用知識：力率の実例</h3>
                    
                    <h4>🏭 機器別の典型的な力率</h4>
                    <table style="width: 100%; margin: 1rem 0;">
                        <thead>
                            <tr style="background: var(--primary-color); color: white;">
                                <th style="padding: 0.5rem;">機器</th>
                                <th style="padding: 0.5rem;">力率</th>
                                <th style="padding: 0.5rem;">特徴</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">白熱電球</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">1.0（100%）</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">抵抗のみ、理想的</td>
                            </tr>
                            <tr style="background: #f5f5f5;">
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">LED照明</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">0.95～0.98</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">電源回路により高力率</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">蛍光灯（安定器）</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">0.5～0.6</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">インダクタンスが大きい</td>
                            </tr>
                            <tr style="background: #f5f5f5;">
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">エアコン（インバータ）</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">0.95～0.98</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">インバータ制御で改善</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">モーター（無負荷）</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">0.2～0.3</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">空回りは力率最悪</td>
                            </tr>
                            <tr style="background: #f5f5f5;">
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">モーター（定格負荷）</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">0.8～0.85</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">適正負荷で改善</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="alert alert-info">
                        <h4>💰 電気料金への影響（実例）</h4>
                        <p><strong>契約電力50kWの工場の場合：</strong></p>
                        <ul>
                            <li>力率85%：基本料金は標準（割引なし）</li>
                            <li>力率95%：基本料金5%割引 → 年間約6万円削減</li>
                            <li>力率75%：基本料金5%割増 → 年間約6万円増加</li>
                        </ul>
                        <p style="margin-top: 0.5rem;">※基本料金1,000円/kWで計算</p>
                    </div>
                </div>
                
                <div class="card">
                    <h3>🔧 力率改善シミュレーション</h3>
                    
                    <div class="alert alert-warning" style="margin-bottom: 1rem;">
                        <h4>💡 なぜ力率改善が必要？</h4>
                        <ul style="margin: 0.5rem 0;">
                            <li><strong>電気料金の削減</strong>：力率が85%未満だと割増料金、85%以上で割引</li>
                            <li><strong>送電損失の削減</strong>：電流が減ることで電線での発熱ロスが減少</li>
                            <li><strong>設備容量の有効活用</strong>：同じ設備でより多くの有効電力を送れる</li>
                            <li><strong>電圧降下の改善</strong>：電流減少により電圧の安定性が向上</li>
                        </ul>
                    </div>
                    <div class="control-group">
                        <label class="control-label">目標力率</label>
                        <div class="slider-container">
                            <input type="range" id="target-pf" min="85" max="100" value="95" step="1" onchange="calculateCapacitor()">
                            <span class="value-display" id="target-pf-value">0.95</span>
                        </div>
                    </div>
                    
                    <div class="result-box">
                        <h4>必要な進相コンデンサ容量</h4>
                        <div class="formula">
                            Q_c = P × (tanθ₁ - tanθ₂)<br>
                            ここで、θ₁ = cos⁻¹(現在の力率)、θ₂ = cos⁻¹(目標力率)
                        </div>
                        <p><strong>必要容量:</strong> <span class="result-value" id="capacitor-kvar">3,000 kvar</span></p>
                        <p><strong>改善効果:</strong></p>
                        <ul>
                            <li>電流削減率: <span id="current-reduction">10.5%</span></li>
                            <li>基本料金削減: <span id="cost-reduction">約10%</span></li>
                            <li>送電損失削減: <span id="loss-reduction">約20%</span></li>
                        </ul>
                        <div class="alert alert-warning" style="margin-top: 1rem;">
                            <p>⚠️ <strong>注意:</strong> 進相コンデンサの過補償は電圧上昇を引き起こすため、適切な容量選定が重要です。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 電圧降下計算タブ -->
        <div id="voltage-drop" class="tab-content">
            <div class="card">
                <h2>📉 電圧降下計算ツール</h2>
                
                <div class="alert alert-info" style="margin-bottom: 1.5rem;">
                    <h4>🔍 電圧降下とは？</h4>
                    <p><strong>電線には抵抗があるため、電流が流れると電圧が下がります。</strong></p>
                    <p>例：100Vの電源から50m離れた場所では、98Vになってしまう（2V降下）</p>
                    
                    <h5 style="margin-top: 1rem;">📊 許容される電圧降下</h5>
                    <ul style="margin: 0.5rem 0;">
                        <li><strong>幹線：2%以内</strong>（200Vなら4V以内）</li>
                        <li><strong>分岐回路：2%以内</strong>（合計で4%以内）</li>
                        <li><strong>一時的な負荷（モーター起動時など）：7%程度</strong></li>
                    </ul>
                    
                    <h5 style="margin-top: 1rem;">⚠️ 電圧降下が大きいと...</h5>
                    <ul style="margin: 0.5rem 0;">
                        <li>照明が暗くなる（90Vで約80%の明るさ）</li>
                        <li>モーターの力が弱くなる（電圧の2乗に比例）</li>
                        <li>電子機器が誤動作する可能性</li>
                        <li>発熱による電力損失が増加</li>
                    </ul>
                </div>
                
                <div class="control-group">
                    <label class="control-label">配電方式</label>
                    <select id="distribution-type" onchange="updateVoltageDrop()">
                        <option value="single2">単相2線式</option>
                        <option value="single3">単相3線式</option>
                        <option value="three3">三相3線式</option>
                    </select>
                    <div class="alert alert-info" style="margin-top: 0.5rem;">
                        <p>💡 <strong>係数の根拠:</strong> 銅の抵抗率 1.78×10⁻⁸ Ωm を基に、往復分を考慮した簡易式です。<br>
                        単相2線式: 35.6 = 2 × 17.8（往復）<br>
                        単相3線式: 17.8（片道）<br>
                        三相3線式: 30.8 = √3 × 17.8</p>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">電線長さ (m)</label>
                    <div class="slider-container">
                        <input type="range" id="cable-length" min="10" max="500" value="100" step="10" onchange="updateVoltageDrop()">
                        <span class="value-display" id="cable-length-value">100m</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">電流 (A)</label>
                    <div class="slider-container">
                        <input type="range" id="current-vd" min="1" max="100" value="30" step="1" onchange="updateVoltageDrop()">
                        <span class="value-display" id="current-vd-value">30A</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">電線断面積 (mm²)</label>
                    <select id="cable-size" onchange="updateVoltageDrop()">
                        <option value="1.6">1.6 mm²</option>
                        <option value="2.0" selected>2.0 mm²</option>
                        <option value="2.6">2.6 mm²</option>
                        <option value="5.5">5.5 mm²</option>
                        <option value="8">8.0 mm²</option>
                        <option value="14">14 mm²</option>
                        <option value="22">22 mm²</option>
                        <option value="38">38 mm²</option>
                    </select>
                </div>
                
                <div class="svg-container">
                    <svg width="600" height="300" viewBox="0 0 600 300">
                        <!-- 電圧降下の視覚化 -->
                        <defs>
                            <linearGradient id="voltageGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#4CAF50;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#FF5252;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        
                        <!-- 電圧レベル表示 -->
                        <rect x="50" y="100" width="500" height="40" fill="url(#voltageGradient)" opacity="0.3"/>
                        
                        <!-- 電源側 -->
                        <rect x="40" y="80" width="20" height="80" fill="#005BAB"/>
                        <text x="50" y="70" text-anchor="middle" font-size="14" font-weight="bold">電源</text>
                        <text x="50" y="180" text-anchor="middle" font-size="12" id="source-voltage">200V</text>
                        
                        <!-- 負荷側 -->
                        <rect x="540" y="80" width="20" height="80" fill="#FF961C"/>
                        <text x="550" y="70" text-anchor="middle" font-size="14" font-weight="bold">負荷</text>
                        <text x="550" y="180" text-anchor="middle" font-size="12" id="load-voltage">194V</text>
                        
                        <!-- 電圧降下の矢印 -->
                        <path d="M 50 120 Q 300 140 550 120" fill="none" stroke="#333" stroke-width="2" stroke-dasharray="5,5"/>
                        <text x="300" y="135" text-anchor="middle" font-size="16" font-weight="bold" id="voltage-drop-text">電圧降下: 6V (3%)</text>
                        
                        <!-- 許容値ライン -->
                        <line x1="50" y1="200" x2="550" y2="200" stroke="#F44336" stroke-width="2" stroke-dasharray="10,5"/>
                        <text x="300" y="215" text-anchor="middle" font-size="12" fill="#F44336">許容値: 2% (4V)</text>
                    </svg>
                </div>
                
                <div class="result-box">
                    <h3>計算結果</h3>
                    <div class="formula" id="voltage-drop-formula">
                        e = 30.8 × L × I / (1000 × A)
                    </div>
                    <p><strong>電圧降下:</strong> <span class="result-value" id="voltage-drop-result">6.0 V</span></p>
                    <p><strong>電圧降下率:</strong> <span class="result-value" id="voltage-drop-percent">3.0 %</span></p>
                    <p><strong>判定:</strong> <span id="voltage-drop-status">
                        <span class="status-indicator status-danger"></span>許容値を超えています
                    </span></p>
                    
                    <div class="alert alert-info">
                        <p>💡 <strong>ヒント:</strong> 電圧降下を減らすには、電線を太くするか、電線長を短くしましょう。</p>
                    </div>
                </div>
                
                <div class="card">
                    <h3>📊 電線サイズ別比較</h3>
                    <div class="comparison-container" id="cable-comparison">
                        <!-- JavaScriptで動的に生成 -->
                    </div>
                </div>
                
                <div class="card" style="background: #f8f9fa;">
                    <h3>📚 実用知識：電圧降下の実例</h3>
                    
                    <h4>🏠 家庭での実例</h4>
                    <div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <p><strong>エアコン専用回路（200V、20A、配線長30m）の場合：</strong></p>
                        <ul>
                            <li>VVF 2.0mm²使用：電圧降下 = 5.3V（2.7%）→ <span style="color: #FF9800;">ギリギリ</span></li>
                            <li>VVF 2.6mm²使用：電圧降下 = 4.1V（2.1%）→ <span style="color: #4CAF50;">適切</span></li>
                            <li>VVF 1.6mm²使用：電圧降下 = 6.7V（3.4%）→ <span style="color: #F44336;">不適切</span></li>
                        </ul>
                        <p style="margin-top: 0.5rem;"><strong>結論：</strong>少し太い電線を使うことで、エアコンの効きが良くなり、電気代も節約できます。</p>
                    </div>
                    
                    <h4>🏭 工場での実例</h4>
                    <div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <p><strong>モーター（三相200V、50A、配線長100m）の場合：</strong></p>
                        <ul>
                            <li>CVT 14mm²：電圧降下 = 11.0V（5.5%）→ 起動困難の可能性</li>
                            <li>CVT 22mm²：電圧降下 = 7.0V（3.5%）→ 通常運転OK</li>
                            <li>CVT 38mm²：電圧降下 = 4.1V（2.1%）→ 理想的</li>
                        </ul>
                        <p style="margin-top: 0.5rem;"><strong>注意：</strong>モーター起動時は定格の6倍程度の電流が流れるため、余裕を持った設計が必要です。</p>
                    </div>
                    
                    <h4>⚡ 電圧降下による具体的な影響</h4>
                    <table style="width: 100%; margin: 1rem 0;">
                        <thead>
                            <tr style="background: var(--primary-color); color: white;">
                                <th style="padding: 0.5rem;">電圧降下率</th>
                                <th style="padding: 0.5rem;">影響</th>
                                <th style="padding: 0.5rem;">対策</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">1%以内</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">ほぼ影響なし</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">理想的な設計</td>
                            </tr>
                            <tr style="background: #f5f5f5;">
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">2%程度</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">わずかな効率低下</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">許容範囲内</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">3～5%</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">機器の性能低下、発熱増加</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">電線サイズアップ推奨</td>
                            </tr>
                            <tr style="background: #f5f5f5;">
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">5%以上</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">起動不良、故障の原因</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">設計見直し必要</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="card" style="background: #f8f9fa;">
                    <h3>📚 実用知識：許容電流の実例</h3>
                    
                    <h4>🏠 家庭での配線選定例</h4>
                    <div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <table style="width: 100%;">
                            <thead>
                                <tr style="background: #e0e0e0;">
                                    <th style="padding: 0.5rem;">用途</th>
                                    <th style="padding: 0.5rem;">想定電流</th>
                                    <th style="padding: 0.5rem;">推奨電線</th>
                                    <th style="padding: 0.5rem;">理由</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 0.5rem;">照明回路</td>
                                    <td style="padding: 0.5rem;">10A程度</td>
                                    <td style="padding: 0.5rem;">VVF 1.6mm²</td>
                                    <td style="padding: 0.5rem;">許容19A > 使用10A ✓</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 0.5rem;">コンセント回路</td>
                                    <td style="padding: 0.5rem;">15A（1500W）</td>
                                    <td style="padding: 0.5rem;">VVF 2.0mm²</td>
                                    <td style="padding: 0.5rem;">許容27A > 使用15A ✓</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.5rem;">エアコン専用</td>
                                    <td style="padding: 0.5rem;">20A</td>
                                    <td style="padding: 0.5rem;">VVF 2.0mm²以上</td>
                                    <td style="padding: 0.5rem;">専用回路で余裕必要</td>
                                </tr>
                                <tr style="background: #f5f5f5;">
                                    <td style="padding: 0.5rem;">IHクッキング</td>
                                    <td style="padding: 0.5rem;">30A（200V）</td>
                                    <td style="padding: 0.5rem;">VVF 2.6mm²以上</td>
                                    <td style="padding: 0.5rem;">大電流のため太線必要</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h4>⚠️ よくある間違いと危険性</h4>
                    <div class="alert alert-danger">
                        <h5>🔥 危険な例</h5>
                        <ul>
                            <li><strong>延長コードの多重接続</strong>：定格を超えやすく火災の原因に</li>
                            <li><strong>古い配線での大電力機器使用</strong>：昔の配線は細い（1.6mm²）ことが多い</li>
                            <li><strong>束ね配線での使用</strong>：放熱できず許容電流が大幅に低下</li>
                        </ul>
                    </div>
                    
                    <h4>🌡️ 温度による許容電流の変化</h4>
                    <div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <p><strong>VVF 2.0mm²（基準30℃で27A）の場合：</strong></p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0;">
                            <div style="background: #E3F2FD; padding: 0.5rem; border-radius: 8px;">
                                <strong>20℃環境</strong><br>
                                許容電流：29.7A（+10%）
                            </div>
                            <div style="background: #FFF3E0; padding: 0.5rem; border-radius: 8px;">
                                <strong>40℃環境</strong><br>
                                許容電流：24.3A（-10%）
                            </div>
                            <div style="background: #FFEBEE; padding: 0.5rem; border-radius: 8px;">
                                <strong>50℃環境</strong><br>
                                許容電流：21.6A（-20%）
                            </div>
                        </div>
                        <p><strong>注意：</strong>天井裏や配管内は夏場50℃を超えることもあります！</p>
                    </div>
                    
                    <h4>💡 プロのアドバイス</h4>
                    <div class="alert alert-success">
                        <ul>
                            <li><strong>将来を見据えた設計</strong>：後から太くするのは困難。最初から余裕を持つ</li>
                            <li><strong>80%ルール</strong>：許容電流の80%以下で使用すれば安心</li>
                            <li><strong>ブレーカーとの協調</strong>：電線の許容電流 > ブレーカー容量にする</li>
                            <li><strong>定期的な点検</strong>：コンセントが熱い場合は要注意</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 電線の許容電流タブ -->
        <div id="allowable-current" class="tab-content">
            <div class="card">
                <h2>⚡ 電線の許容電流チェッカー</h2>
                
                <div class="alert alert-info" style="margin-bottom: 1.5rem;">
                    <h4>🔍 許容電流とは？</h4>
                    <p><strong>電線に安全に流せる最大電流のことです。これを超えると...</strong></p>
                    <ul style="margin: 0.5rem 0;">
                        <li>電線が発熱し、被覆が溶ける危険</li>
                        <li>最悪の場合、火災の原因に</li>
                        <li>電線の寿命が著しく短くなる</li>
                    </ul>
                    
                    <h5 style="margin-top: 1rem;">📊 許容電流を決める要因</h5>
                    <table style="width: 100%; margin: 0.5rem 0;">
                        <tr>
                            <td style="padding: 0.5rem;"><strong>電線の太さ</strong></td>
                            <td style="padding: 0.5rem;">太いほど多くの電流が流せる</td>
                        </tr>
                        <tr style="background: #f5f5f5;">
                            <td style="padding: 0.5rem;"><strong>絶縁材料</strong></td>
                            <td style="padding: 0.5rem;">耐熱性が高いほど許容電流大</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;"><strong>布設条件</strong></td>
                            <td style="padding: 0.5rem;">放熱しやすい環境ほど有利</td>
                        </tr>
                        <tr style="background: #f5f5f5;">
                            <td style="padding: 0.5rem;"><strong>周囲温度</strong></td>
                            <td style="padding: 0.5rem;">温度が高いと許容電流は減少</td>
                        </tr>
                    </table>
                    
                    <h5 style="margin-top: 1rem;">⚠️ 安全率の考え方</h5>
                    <p><strong>使用率80%以下を推奨する理由：</strong></p>
                    <ul style="margin: 0.5rem 0;">
                        <li>将来の負荷増加に対応できる余裕</li>
                        <li>突入電流（起動時の大電流）への対応</li>
                        <li>電線の長寿命化（発熱による劣化を抑制）</li>
                        <li>異常時の安全マージン確保</li>
                    </ul>
                </div>
                
                <div class="control-group">
                    <label class="control-label">電線種類</label>
                    <select id="cable-type" onchange="updateAllowableCurrent()">
                        <option value="vvf">VVF（平形ビニル絶縁電線）</option>
                        <option value="iv">IV（600Vビニル絶縁電線）</option>
                        <option value="cv">CV（架橋ポリエチレン絶縁電線）</option>
                        <option value="cvt">CVT（トリプレックス形）</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label class="control-label">電線サイズ</label>
                    <select id="cable-size-ac" onchange="updateAllowableCurrent()">
                        <option value="1.6">1.6 mm²</option>
                        <option value="2.0">2.0 mm²</option>
                        <option value="2.6">2.6 mm²</option>
                        <option value="5.5">5.5 mm²</option>
                        <option value="8">8.0 mm²</option>
                        <option value="14">14 mm²</option>
                        <option value="22">22 mm²</option>
                        <option value="38">38 mm²</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label class="control-label">布設条件</label>
                    <select id="installation-type" onchange="updateAllowableCurrent()">
                        <option value="air">気中布設（単独）</option>
                        <option value="conduit">電線管内布設</option>
                        <option value="bundle">たばね布設</option>
                        <option value="buried">地中埋設</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label class="control-label">周囲温度</label>
                    <div class="slider-container">
                        <input type="range" id="ambient-temp" min="20" max="50" value="30" step="5" onchange="updateAllowableCurrent()">
                        <span class="value-display" id="ambient-temp-value">30°C</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">使用電流 (A)</label>
                    <div class="slider-container">
                        <input type="range" id="actual-current" min="0" max="100" value="25" step="1" onchange="updateAllowableCurrent()">
                        <span class="value-display" id="actual-current-value">25A</span>
                    </div>
                </div>
                
                <div class="svg-container">
                    <svg width="600" height="400" viewBox="0 0 600 400">
                        <!-- 許容電流のゲージ表示 -->
                        <defs>
                            <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#4CAF50;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#FFC107;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#F44336;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        
                        <!-- ゲージ背景 -->
                        <path d="M 100 250 A 150 150 0 0 1 500 250" fill="none" stroke="#e0e0e0" stroke-width="30"/>
                        <path d="M 100 250 A 150 150 0 0 1 500 250" fill="none" stroke="url(#gaugeGradient)" stroke-width="25" stroke-dasharray="0 628" id="gauge-fill"/>
                        
                        <!-- 目盛り -->
                        <g id="gauge-ticks">
                            <!-- JavaScriptで動的に生成 -->
                        </g>
                        
                        <!-- 中心表示 -->
                        <text x="300" y="200" text-anchor="middle" font-size="48" font-weight="bold" id="current-percent">75%</text>
                        <text x="300" y="230" text-anchor="middle" font-size="16">使用率</text>
                        
                        <!-- 許容電流表示 -->
                        <text x="300" y="280" text-anchor="middle" font-size="14">許容電流: <tspan font-weight="bold" id="allowable-current-value">35A</tspan></text>
                        <text x="300" y="300" text-anchor="middle" font-size="14">使用電流: <tspan font-weight="bold" id="used-current-value">25A</tspan></text>
                    </svg>
                </div>
                
                <div class="result-box">
                    <h3>安全性判定</h3>
                    <p><strong>許容電流:</strong> <span class="result-value" id="allowable-current">35 A</span></p>
                    <p><strong>使用率:</strong> <span class="result-value" id="usage-percent">71.4 %</span></p>
                    <p><strong>判定:</strong> <span id="current-status">
                        <span class="status-indicator status-good"></span>安全に使用できます
                    </span></p>
                    
                    <div class="alert alert-warning">
                        <p>⚠️ <strong>注意:</strong> 使用率は80%以下に保つことを推奨します。</p>
                    </div>
                </div>
                
                <div class="card">
                    <h3>📋 許容電流一覧表</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                        ※ データは電気設備技術基準の解釈および各メーカーカタログを参考にした標準値です。<br>
                        実際の施工では必ず最新の規格・基準を確認してください。
                    </p>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--primary-color); color: white;">
                                <th style="padding: 0.75rem; text-align: left;">サイズ (mm²)</th>
                                <th style="padding: 0.75rem; text-align: center;">気中布設</th>
                                <th style="padding: 0.75rem; text-align: center;">管内布設</th>
                                <th style="padding: 0.75rem; text-align: center;">たばね布設</th>
                            </tr>
                        </thead>
                        <tbody id="allowable-current-table">
                            <!-- JavaScriptで動的に生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 配電方式比較タブ -->
        <div id="distribution-system" class="tab-content">
            <div class="card">
                <h2>🔌 配電方式の詳細解説</h2>
                
                <div class="alert alert-info" style="margin-bottom: 1.5rem;">
                    <h4>🔍 配電方式の基本理解</h4>
                    <p><strong>電気を送る方法には主に3つの方式があります：</strong></p>
                    
                    <table style="width: 100%; margin: 1rem 0; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--primary-color); color: white;">
                                <th style="padding: 0.75rem; border: 1px solid #ddd;">方式</th>
                                <th style="padding: 0.75rem; border: 1px solid #ddd;">電線数</th>
                                <th style="padding: 0.75rem; border: 1px solid #ddd;">主な用途</th>
                                <th style="padding: 0.75rem; border: 1px solid #ddd;">特徴</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;"><strong>単相2線式</strong></td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">2本</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">小規模・低電力</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">シンプル、安価</td>
                            </tr>
                            <tr style="background: #f5f5f5;">
                                <td style="padding: 0.5rem; border: 1px solid #ddd;"><strong>単相3線式</strong></td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">3本</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">一般住宅</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">100V/200V両用</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;"><strong>三相3線式</strong></td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">3本</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">工業・大電力</td>
                                <td style="padding: 0.5rem; border: 1px solid #ddd;">高効率、モーター向け</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h5 style="margin-top: 1rem;">💡 重要なポイント</h5>
                    <ul style="margin: 0.5rem 0;">
                        <li><strong>電線数と送電能力は比例しない</strong>：三相は3本で√3倍（約1.73倍）の電力</li>
                        <li><strong>電圧の種類</strong>：日本では100V、200V、400V（特殊用途）が主流</li>
                        <li><strong>周波数の違い</strong>：東日本50Hz、西日本60Hz（静岡県富士川が境界）</li>
                        <li><strong>契約種別</strong>：従量電灯（家庭用）と動力（工業用）で料金体系が異なる</li>
                    </ul>
                </div>
                

                
                <div class="comparison-container">
                    <div class="comparison-item" style="border: 2px solid #4CAF50;">
                        <h4>🏠 単相2線式</h4>
                        <div class="svg-container">
                            <svg width="250" height="200" viewBox="0 0 250 200">
                                <!-- 電源 -->
                                <rect x="20" y="60" width="40" height="80" fill="#005BAB"/>
                                <text x="40" y="50" text-anchor="middle" font-size="12" font-weight="bold">電源</text>
                                
                                <!-- 配線 -->
                                <line x1="60" y1="80" x2="190" y2="80" stroke="#333" stroke-width="3"/>
                                <text x="125" y="75" text-anchor="middle" font-size="10">L (電圧線)</text>
                                
                                <line x1="60" y1="120" x2="190" y2="120" stroke="#666" stroke-width="3"/>
                                <text x="125" y="135" text-anchor="middle" font-size="10">N (中性線)</text>
                                
                                <!-- 負荷 -->
                                <rect x="190" y="60" width="40" height="80" fill="#FF961C"/>
                                <text x="210" y="50" text-anchor="middle" font-size="12" font-weight="bold">負荷</text>
                                
                                <!-- 電圧表示 -->
                                <text x="125" y="160" text-anchor="middle" font-size="14" font-weight="bold">100V or 200V</text>
                            </svg>
                        </div>
                        

                        
                        <h5>📋 特徴と用途</h5>
                        <ul>
                            <li><strong>構成:</strong> 2本線（L:ライブ線、N:ニュートラル線）</li>
                            <li><strong>電圧:</strong> 100V または 200V（どちらか一方）</li>
                            <li><strong>実際の使用例:</strong>
                                <ul>
                                    <li>アパートの照明回路</li>
                                    <li>小さな店舗の電源</li>
                                    <li>農業用小屋の電源</li>
                                </ul>
                            </li>
                            <li><strong>メリット:</strong> 
                                <ul>
                                    <li>配線がシンプルで工事費が安い</li>
                                    <li>メンテナンスが簡単</li>
                                    <li>小規模用途に最適</li>
                                </ul>
                            </li>
                            <li><strong>デメリット:</strong>
                                <ul>
                                    <li>大きな電力は送れない（最大3kW程度）</li>
                                    <li>100Vと200Vを同時に使えない</li>
                                    <li>電圧降下の影響を受けやすい</li>
                                </ul>
                            </li>
                        </ul>
                        
                        <div class="alert alert-warning">
                            <p>⚡ <strong>具体例:</strong> 6畳間のエアコン（100V、10A）と照明を使うだけなら十分ですが、IHクッキングヒーターは使えません。</p>
                        </div>
                        
                        <div class="card" style="background: #f8f9fa; margin-top: 1rem;">
                            <h5>🔧 技術的な詳細</h5>
                            <p><strong>なぜ2本の電線が必要？</strong></p>
                            <p>電気は「行き」と「帰り」の道が必要です。水道でいえば、蛇口（L線）と排水口（N線）のような関係です。</p>
                            
                            <p style="margin-top: 0.5rem;"><strong>L線とN線の違い：</strong></p>
                            <ul>
                                <li><strong>L線（ライブ線）</strong>：電圧がかかっている危険な線（触ると感電）</li>
                                <li><strong>N線（ニュートラル線）</strong>：大地と同じ電位で比較的安全（それでも触らない）</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="comparison-item" style="border: 2px solid #2196F3;">
                        <h4>🏘️ 単相3線式</h4>
                        <div class="svg-container">
                            <svg width="250" height="200" viewBox="0 0 250 200">
                                <!-- 電源 -->
                                <rect x="20" y="40" width="40" height="120" fill="#005BAB"/>
                                <text x="40" y="30" text-anchor="middle" font-size="12" font-weight="bold">電源</text>
                                
                                <!-- 配線 -->
                                <line x1="60" y1="60" x2="190" y2="60" stroke="#333" stroke-width="3"/>
                                <text x="125" y="55" text-anchor="middle" font-size="10">L1</text>
                                
                                <line x1="60" y1="100" x2="190" y2="100" stroke="#666" stroke-width="3"/>
                                <text x="125" y="95" text-anchor="middle" font-size="10">N</text>
                                
                                <line x1="60" y1="140" x2="190" y2="140" stroke="#333" stroke-width="3"/>
                                <text x="125" y="155" text-anchor="middle" font-size="10">L2</text>
                                
                                <!-- 負荷 -->
                                <rect x="190" y="40" width="40" height="120" fill="#FF961C"/>
                                <text x="210" y="30" text-anchor="middle" font-size="12" font-weight="bold">負荷</text>
                                
                                <!-- 電圧表示 -->
                                <text x="125" y="175" text-anchor="middle" font-size="12" font-weight="bold">100V/200V両用</text>
                            </svg>
                        </div>
                        

                        
                        <h5>📋 特徴と用途</h5>
                        <ul>
                            <li><strong>構成:</strong> 3本線（L1、N:中性線、L2）</li>
                            <li><strong>電圧:</strong> 
                                <ul>
                                    <li>L1-N間: 100V（テレビ、照明用）</li>
                                    <li>L2-N間: 100V（冷蔵庫、洗濯機用）</li>
                                    <li>L1-L2間: 200V（エアコン、IH用）</li>
                                </ul>
                            </li>
                            <li><strong>実際の使用例:</strong>
                                <ul>
                                    <li>一般的な戸建て住宅（ほぼ100%）</li>
                                    <li>マンションの各戸</li>
                                    <li>小規模事務所</li>
                                </ul>
                            </li>
                            <li><strong>メリット:</strong>
                                <ul>
                                    <li>100Vと200Vを同時に使える</li>
                                    <li>電力のバランスが取りやすい</li>
                                    <li>将来の増設に対応しやすい</li>
                                    <li>電線3本で2倍の電力が送れる（効率的）</li>
                                </ul>
                            </li>
                            <li><strong>デメリット:</strong>
                                <ul>
                                    <li>配線がやや複雑</li>
                                    <li>L1とL2のバランスを考慮する必要がある</li>
                                    <li>工事費が2線式より高い</li>
                                </ul>
                            </li>
                        </ul>
                        
                        <div class="alert alert-success">
                            <p>🏠 <strong>家庭での実例:</strong><br>
                            - L1-N（100V）: リビングの照明、テレビ、パソコン<br>
                            - L2-N（100V）: 寝室の照明、扇風機、スマホ充電<br>
                            - L1-L2（200V）: エアコン、IHクッキングヒーター、エコキュート</p>
                        </div>
                        
                        <div class="card" style="background: #f8f9fa; margin-top: 1rem;">
                            <h5>🔧 技術的な詳細</h5>
                            <p><strong>なぜ3本で100Vと200Vが使える？</strong></p>
                            <p>中性線（N）を中心に、L1とL2が逆位相（180度ずれた）の電圧を持っているためです。</p>
                            
                            <div style="background: white; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                                <p><strong>電圧の関係：</strong></p>
                                <ul>
                                    <li>L1-N間：+100V</li>
                                    <li>L2-N間：-100V（L1と逆位相）</li>
                                    <li>L1-L2間：100V - (-100V) = 200V</li>
                                </ul>
                            </div>
                            
                            <p style="margin-top: 1rem;"><strong>バランスの重要性：</strong></p>
                            <p>L1側とL2側の使用電力が偏ると、中性線に電流が流れて損失が増えます。電気工事士は両側のバランスを考えて配線設計します。</p>
                        </div>
                    </div>
                    
                    <div class="comparison-item" style="border: 2px solid #FF5722;">
                        <h4>🏭 三相3線式</h4>
                        <div class="svg-container">
                            <svg width="250" height="220" viewBox="0 0 250 220">
                                <!-- 電源 -->
                                <rect x="20" y="40" width="40" height="120" fill="#005BAB"/>
                                <text x="40" y="30" text-anchor="middle" font-size="12" font-weight="bold">電源</text>
                                
                                <!-- 配線 -->
                                <line x1="60" y1="60" x2="190" y2="60" stroke="#F44336" stroke-width="3"/>
                                <text x="125" y="55" text-anchor="middle" font-size="10">R相（赤）</text>
                                
                                <line x1="60" y1="100" x2="190" y2="100" stroke="#4CAF50" stroke-width="3"/>
                                <text x="125" y="95" text-anchor="middle" font-size="10">S相（白）</text>
                                
                                <line x1="60" y1="140" x2="190" y2="140" stroke="#2196F3" stroke-width="3"/>
                                <text x="125" y="155" text-anchor="middle" font-size="10">T相（青）</text>
                                
                                <!-- 負荷（モーター） -->
                                <circle cx="210" cy="100" r="35" fill="#FF961C" stroke="#333" stroke-width="2"/>
                                <text x="210" y="105" text-anchor="middle" font-size="16" font-weight="bold">M</text>
                                <text x="210" y="30" text-anchor="middle" font-size="12" font-weight="bold">モーター</text>
                                
                                <!-- 電圧表示 -->
                                <text x="125" y="175" text-anchor="middle" font-size="12" font-weight="bold">200V (線間)</text>
                                
                                <!-- 位相表示 -->
                                <text x="125" y="195" text-anchor="middle" font-size="10">各相120°ずつずれている</text>
                            </svg>
                        </div>
                        

                        
                        <h5>📋 特徴と用途</h5>
                        <ul>
                            <li><strong>構成:</strong> 3本線（R相、S相、T相）各相は120°位相がずれている</li>
                            <li><strong>電圧:</strong>
                                <ul>
                                    <li>線間電圧: 200V（R-S、S-T、T-R間）</li>
                                    <li>相電圧: 約115V（中性点がある場合）</li>
                                </ul>
                            </li>
                            <li><strong>実際の使用例:</strong>
                                <ul>
                                    <li>工場の生産ライン</li>
                                    <li>ビルの大型エレベーター</li>
                                    <li>ショッピングモールの空調システム</li>
                                    <li>電車のモーター</li>
                                    <li>大型ポンプ、コンプレッサー</li>
                                </ul>
                            </li>
                            <li><strong>メリット:</strong>
                                <ul>
                                    <li>同じ電線サイズで√3倍（約1.73倍）の電力が送れる</li>
                                    <li>モーターが滑らかに回転する</li>
                                    <li>電力の脈動が少ない</li>
                                    <li>大電力の送電に最適</li>
                                </ul>
                            </li>
                            <li><strong>デメリット:</strong>
                                <ul>
                                    <li>一般家庭では使えない（工業用）</li>
                                    <li>配線・保護装置が複雑</li>
                                    <li>感電時の危険性が高い</li>
                                    <li>専門知識が必要</li>
                                </ul>
                            </li>
                        </ul>
                        
                        <div class="alert alert-danger">
                            <p>⚠️ <strong>なぜモーターに最適？</strong><br>
                            3つの波が順番に来ることで、モーターに連続的に力が加わるため、振動が少なく効率的に回転します。単相だと力に脈動があり効率が悪いのです。</p>
                        </div>
                        
                        <div class="card" style="background: #f8f9fa; margin-top: 1rem;">
                            <h5>🔧 技術的な詳細</h5>
                            <p><strong>なぜ√3（1.732）倍の電力？</strong></p>
                            <p>3つの電圧が120度ずつずれているため、ベクトル計算すると√3倍になります。</p>
                            
                            <div style="background: white; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                                <p><strong>計算例（200V、50A）：</strong></p>
                                <ul>
                                    <li>単相の電力：200V × 50A = 10kW</li>
                                    <li>三相の電力：√3 × 200V × 50A = 1.732 × 10kW = <strong>17.32kW</strong></li>
                                    <li>つまり、同じ電線で<strong>73%も多く</strong>の電力が送れる！</li>
                                </ul>
                            </div>
                            
                            <p style="margin-top: 1rem;"><strong>位相のずれとは？</strong></p>
                            <p>3つの電圧波形が時間的に120度（1/3周期）ずつずれています。これにより：</p>
                            <ul>
                                <li>どの瞬間も必ずどれかの相が高い電圧を持つ</li>
                                <li>3相の合計電流は常にゼロ（バランス時）</li>
                                <li>中性線が不要（Y結線の中性点は電位ゼロ）</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="background: linear-gradient(135deg, #FFF9C4 0%, #FFECB3 100%); margin-top: 2rem;">
                    <h3>🎓 配電方式の選び方ガイド</h3>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                        <thead>
                            <tr style="background: var(--primary-color); color: white;">
                                <th style="padding: 1rem; text-align: left;">使用場所・目的</th>
                                <th style="padding: 1rem; text-align: center;">推奨方式</th>
                                <th style="padding: 1rem; text-align: left;">理由</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: white;">
                                <td style="padding: 1rem; border: 1px solid #e0e0e0;">
                                    <strong>ワンルームマンション</strong><br>
                                    <small>照明とコンセント程度</small>
                                </td>
                                <td style="padding: 1rem; border: 1px solid #e0e0e0; text-align: center;">
                                    <span style="background: #4CAF50; color: white; padding: 0.25rem 0.75rem; border-radius: 20px;">単相2線式</span>
                                </td>
                                <td style="padding: 1rem; border: 1px solid #e0e0e0;">
                                    必要電力が小さく、コストを抑えられる
                                </td>
                            </tr>
                            <tr style="background: #f5f5f5;">
                                <td style="padding: 1rem; border: 1px solid #e0e0e0;">
                                    <strong>一般住宅</strong><br>
                                    <small>エアコン、IH、家電多数</small>
                                </td>
                                <td style="padding: 1rem; border: 1px solid #e0e0e0; text-align: center;">
                                    <span style="background: #2196F3; color: white; padding: 0.25rem 0.75rem; border-radius: 20px;">単相3線式</span>
                                </td>
                                <td style="padding: 1rem; border: 1px solid #e0e0e0;">
                                    100V/200V両方使え、将来の増設にも対応
                                </td>
                            </tr>
                            <tr style="background: white;">
                                <td style="padding: 1rem; border: 1px solid #e0e0e0;">
                                    <strong>町工場・製造業</strong><br>
                                    <small>大型機械、モーター多数</small>
                                </td>
                                <td style="padding: 1rem; border: 1px solid #e0e0e0; text-align: center;">
                                    <span style="background: #FF5722; color: white; padding: 0.25rem 0.75rem; border-radius: 20px;">三相3線式</span>
                                </td>
                                <td style="padding: 1rem; border: 1px solid #e0e0e0;">
                                    モーター効率が良く、大電力を扱える
                                </td>
                            </tr>
                            <tr style="background: #f5f5f5;">
                                <td style="padding: 1rem; border: 1px solid #e0e0e0;">
                                    <strong>コンビニ・小規模店舗</strong><br>
                                    <small>照明、冷蔵庫、エアコン</small>
                                </td>
                                <td style="padding: 1rem; border: 1px solid #e0e0e0; text-align: center;">
                                    <span style="background: #2196F3; color: white; padding: 0.25rem 0.75rem; border-radius: 20px;">単相3線式</span>
                                </td>
                                <td style="padding: 1rem; border: 1px solid #e0e0e0;">
                                    200V機器も使え、電気料金を抑えられる
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="card">
                    <h3>🔄 配電方式別の実用計算ツール</h3>
                    
                    <div class="control-group">
                        <label class="control-label">計算したい内容</label>
                        <select id="calc-type" onchange="updateDistributionCalc()">
                            <option value="power">送電可能電力の比較</option>
                            <option value="current">必要な電流値の計算</option>
                            <option value="efficiency">送電効率の比較</option>
                            <option value="cost">月間電気料金の試算</option>
                        </select>
                    </div>
                    
                    <div id="power-calc" class="calc-section">
                        <div class="control-group">
                            <label class="control-label">比較する配電方式</label>
                            <select id="compare-distribution" onchange="compareDistribution()">
                                <option value="all">全方式を比較</option>
                                <option value="single2">単相2線式のみ</option>
                                <option value="single3">単相3線式のみ</option>
                                <option value="three3">三相3線式のみ</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">電圧 (V)</label>
                            <div class="slider-container">
                                <input type="range" id="compare-voltage" min="100" max="400" value="200" step="10" onchange="compareDistribution()">
                                <span class="value-display" id="compare-voltage-value">200V</span>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">電流 (A)</label>
                            <div class="slider-container">
                                <input type="range" id="compare-current" min="10" max="100" value="50" step="5" onchange="compareDistribution()">
                                <span class="value-display" id="compare-current-value">50A</span>
                            </div>
                        </div>
                        
                        <div class="result-box">
                            <h4>配電方式別の送電能力</h4>
                            <div id="distribution-comparison-result">
                                <!-- JavaScriptで動的に生成 -->
                            </div>
                        </div>
                    </div>
                    
                    <div id="current-calc" class="calc-section" style="display: none;">
                        <div class="control-group">
                            <label class="control-label">必要な電力 (kW)</label>
                            <div class="slider-container">
                                <input type="range" id="required-power" min="1" max="50" value="10" step="1" onchange="calculateRequiredCurrent()">
                                <span class="value-display" id="required-power-value">10kW</span>
                            </div>
                        </div>
                        
                        <div class="result-box">
                            <h4>各配電方式で必要な電流値</h4>
                            <div id="required-current-result">
                                <!-- JavaScriptで動的に生成 -->
                            </div>
                        </div>
                    </div>
                    
                    <div id="efficiency-calc" class="calc-section" style="display: none;">
                        <div class="control-group">
                            <label class="control-label">送電距離 (m)</label>
                            <div class="slider-container">
                                <input type="range" id="transmission-distance" min="10" max="500" value="100" step="10" onchange="calculateEfficiency()">
                                <span class="value-display" id="transmission-distance-value">100m</span>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">送電電力 (kW)</label>
                            <div class="slider-container">
                                <input type="range" id="transmission-power" min="1" max="50" value="10" step="1" onchange="calculateEfficiency()">
                                <span class="value-display" id="transmission-power-value">10kW</span>
                            </div>
                        </div>
                        
                        <div class="result-box">
                            <h4>送電損失の比較</h4>
                            <div id="efficiency-result">
                                <!-- JavaScriptで動的に生成 -->
                            </div>
                        </div>
                    </div>
                    
                    <div id="cost-calc" class="calc-section" style="display: none;">
                        <div class="control-group">
                            <label class="control-label">使用電力量 (kWh/月)</label>
                            <div class="slider-container">
                                <input type="range" id="monthly-usage" min="100" max="1000" value="300" step="50" onchange="calculateCost()">
                                <span class="value-display" id="monthly-usage-value">300kWh</span>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">契約電力 (kW)</label>
                            <div class="slider-container">
                                <input type="range" id="contract-power" min="3" max="50" value="10" step="1" onchange="calculateCost()">
                                <span class="value-display" id="contract-power-value">10kW</span>
                            </div>
                        </div>
                        
                        <div class="result-box">
                            <h4>月間電気料金の試算</h4>
                            <div id="cost-result">
                                <!-- JavaScriptで動的に生成 -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);">
                    <h3>💡 配電方式の豆知識</h3>
                    
                    <div class="alert alert-info">
                        <h4>🤔 なぜ三相は効率が良いの？</h4>
                        <p>三相交流は、3つの波が120度ずつずれて重なることで、電力の「谷間」がなくなります。単相だと電力に脈動（強弱）があるため、効率が落ちるのです。</p>
                    </div>
                    
                    <div class="alert alert-warning">
                        <h4>⚡ 家庭で三相を使わない理由</h4>
                        <ul style="margin: 0.5rem 0;">
                            <li><strong>安全性:</strong> 三相は常に電圧がかかっているため、感電リスクが高い</li>
                            <li><strong>必要性:</strong> 家庭用機器はモーターが小さく、単相で十分</li>
                            <li><strong>コスト:</strong> 三相の配線工事は高額で、保護装置も複雑</li>
                            <li><strong>契約:</strong> 電力会社との契約が「動力」となり、基本料金が高い</li>
                        </ul>
                    </div>
                    
                    <div class="alert alert-success">
                        <h4>🏠 単相3線式が家庭の標準になった理由</h4>
                        <p><strong>歴史的背景:</strong> 昔は100Vのみでしたが、エアコンやIHなど200V機器が普及し、単相3線式が標準になりました。アメリカでは120V/240V、ヨーロッパでは230V単相が主流など、国によって異なります。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // タブ切り替え機能
        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
            
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            buttons.forEach(button => {
                button.classList.remove('active');
            });
            
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }
        
        // 保存された結果
        let savedResults = [];
        
        // 比較パネルの表示切替
        function toggleComparisonPanel() {
            const panel = document.getElementById('comparison-panel');
            panel.classList.toggle('active');
        }
        
        // 結果を保存
        function saveResult(type, data) {
            const result = {
                id: Date.now(),
                type: type,
                timestamp: new Date().toLocaleString('ja-JP'),
                data: data
            };
            
            savedResults.push(result);
            updateSavedResults();
            
            // 保存完了の通知
            showNotification('計算結果を保存しました');
        }
        
        // 保存結果の表示更新
        function updateSavedResults() {
            const container = document.getElementById('saved-results');
            
            if (savedResults.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">保存された結果がありません</p>';
                return;
            }
            
            container.innerHTML = savedResults.map(result => `
                <div class="saved-result">
                    <button class="delete-result" onclick="deleteResult(${result.id})">削除</button>
                    <h4>${result.type}</h4>
                    <p style="font-size: 0.8rem; color: #666;">${result.timestamp}</p>
                    <div style="margin-top: 0.5rem;">
                        ${formatResultData(result.type, result.data)}
                    </div>
                </div>
            `).join('');
        }
        
        // 結果データのフォーマット
        function formatResultData(type, data) {
            switch(type) {
                case '電力と力率':
                    return `
                        <p>有効電力: ${data.activePower}</p>
                        <p>無効電力: ${data.reactivePower}</p>
                        <p>皮相電力: ${data.apparentPower}</p>
                        <p>力率: ${data.powerFactor}</p>
                    `;
                case '電圧降下':
                    return `
                        <p>電圧降下: ${data.drop}</p>
                        <p>降下率: ${data.percent}</p>
                        <p>電線: ${data.size}</p>
                        <p>長さ: ${data.length}</p>
                    `;
                case '許容電流':
                    return `
                        <p>許容電流: ${data.allowable}</p>
                        <p>使用電流: ${data.actual}</p>
                        <p>使用率: ${data.usage}</p>
                        <p>電線: ${data.type} ${data.size}</p>
                    `;
                default:
                    return '';
            }
        }
        
        // 結果を削除
        function deleteResult(id) {
            savedResults = savedResults.filter(r => r.id !== id);
            updateSavedResults();
        }
        
        // 通知表示
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--success-color);
                color: white;
                padding: 1rem 2rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 2000;
                animation: slideDown 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }
        
        // 電力と力率の計算
        function updatePowerFactor() {
            const voltage = parseFloat(document.getElementById('voltage-pf').value);
            const current = parseFloat(document.getElementById('current-pf').value);
            const pf = parseFloat(document.getElementById('power-factor').value) / 100;
            
            // 値の更新
            document.getElementById('voltage-pf-value').textContent = voltage + 'V';
            document.getElementById('current-pf-value').textContent = current + 'A';
            document.getElementById('power-factor-value').textContent = pf.toFixed(2);
            
            // 計算
            const apparentPower = voltage * current;
            const activePower = apparentPower * pf;
            const reactivePower = apparentPower * Math.sqrt(1 - pf * pf);
            const phaseAngle = Math.acos(pf) * 180 / Math.PI;
            
            // 結果表示
            document.getElementById('active-power').textContent = activePower.toLocaleString() + ' W';
            document.getElementById('reactive-power').textContent = reactivePower.toLocaleString() + ' var';
            document.getElementById('apparent-power').textContent = apparentPower.toLocaleString() + ' VA';
            document.getElementById('phase-angle').textContent = phaseAngle.toFixed(1) + '°';
            
            // SVGの更新
            updatePowerTriangle(activePower, reactivePower, apparentPower, phaseAngle);
        }
        
        function updatePowerTriangle(P, Q, S, angle) {
            // 三角形のスケール調整
            const scale = 300 / S * 10000; // 10kVAを基準
            const Px = Math.min(P * scale / 10000, 300);
            const Qy = Math.min(Q * scale / 10000, 100);
            
            // 有効電力線
            const activeLine = document.querySelector('#triangle-group line:nth-child(1)');
            activeLine.setAttribute('x2', 100 + Px);
            
            // 無効電力線
            const reactiveLine = document.querySelector('#triangle-group line:nth-child(3)');
            reactiveLine.setAttribute('x1', 100 + Px);
            reactiveLine.setAttribute('x2', 100 + Px);
            reactiveLine.setAttribute('y2', 300 - Qy);
            
            // 皮相電力線
            const apparentLine = document.querySelector('#triangle-group line:nth-child(5)');
            apparentLine.setAttribute('x2', 100 + Px);
            apparentLine.setAttribute('y2', 300 - Qy);
            
            // テキスト更新
            document.getElementById('active-power-text').textContent = Math.round(P) + 'W';
            document.getElementById('reactive-power-text').textContent = Math.round(Q) + 'var';
            document.getElementById('apparent-power-text').textContent = Math.round(S) + 'VA';
            document.getElementById('angle-text').textContent = 'θ=' + angle.toFixed(1) + '°';
        }
        
        // 進相コンデンサ計算
        function calculateCapacitor() {
            const voltage = parseFloat(document.getElementById('voltage-pf').value);
            const current = parseFloat(document.getElementById('current-pf').value);
            const currentPF = parseFloat(document.getElementById('power-factor').value) / 100;
            const targetPF = parseFloat(document.getElementById('target-pf').value) / 100;
            
            document.getElementById('target-pf-value').textContent = targetPF.toFixed(2);
            
            const P = voltage * current * currentPF;
            const currentAngle = Math.acos(currentPF);
            const targetAngle = Math.acos(targetPF);
            
            const Qc = P * (Math.tan(currentAngle) - Math.tan(targetAngle));
            
            const currentReduction = (1 - targetPF / currentPF) * 100;
            const costReduction = (targetPF - currentPF) * 100;
            const lossReduction = (1 - Math.pow(targetPF / currentPF, 2)) * 100;
            
            document.getElementById('capacitor-kvar').textContent = (Qc / 1000).toFixed(1) + ' kvar';
            document.getElementById('current-reduction').textContent = currentReduction.toFixed(1) + '%';
            document.getElementById('cost-reduction').textContent = '約' + costReduction.toFixed(0) + '%';
            document.getElementById('loss-reduction').textContent = '約' + lossReduction.toFixed(0) + '%';
        }
        
        // 電力と力率の結果を保存
        function savePowerFactorResult() {
            const data = {
                activePower: document.getElementById('active-power').textContent,
                reactivePower: document.getElementById('reactive-power').textContent,
                apparentPower: document.getElementById('apparent-power').textContent,
                powerFactor: document.getElementById('power-factor-value').textContent
            };
            saveResult('電力と力率', data);
        }
        
        // 電圧降下計算
        function updateVoltageDrop() {
            const type = document.getElementById('distribution-type').value;
            const length = parseFloat(document.getElementById('cable-length').value);
            const current = parseFloat(document.getElementById('current-vd').value);
            const size = parseFloat(document.getElementById('cable-size').value);
            
            // 値の更新
            document.getElementById('cable-length-value').textContent = length + 'm';
            document.getElementById('current-vd-value').textContent = current + 'A';
            
            // 係数設定
            let k;
            switch(type) {
                case 'single2':
                    k = 35.6; // 2倍
                    document.getElementById('voltage-drop-formula').textContent = 'e = 35.6 × L × I / (1000 × A)';
                    break;
                case 'single3':
                    k = 17.8;
                    document.getElementById('voltage-drop-formula').textContent = 'e = 17.8 × L × I / (1000 × A)';
                    break;
                case 'three3':
                    k = 30.8;
                    document.getElementById('voltage-drop-formula').textContent = 'e = 30.8 × L × I / (1000 × A)';
                    break;
            }
            
            // 電圧降下計算
            const voltageDrop = k * length * current / (1000 * size);
            const baseVoltage = type === 'single2' ? 100 : 200;
            const dropPercent = voltageDrop / baseVoltage * 100;
            
            // 結果表示
            document.getElementById('voltage-drop-result').textContent = voltageDrop.toFixed(1) + ' V';
            document.getElementById('voltage-drop-percent').textContent = dropPercent.toFixed(1) + ' %';
            
            // SVG更新
            document.getElementById('source-voltage').textContent = baseVoltage + 'V';
            document.getElementById('load-voltage').textContent = (baseVoltage - voltageDrop).toFixed(0) + 'V';
            document.getElementById('voltage-drop-text').textContent = '電圧降下: ' + voltageDrop.toFixed(1) + 'V (' + dropPercent.toFixed(1) + '%)';
            
            // 判定
            const statusElement = document.getElementById('voltage-drop-status');
            if (dropPercent <= 2) {
                statusElement.innerHTML = '<span class="status-indicator status-good"></span>許容値内です';
            } else if (dropPercent <= 3) {
                statusElement.innerHTML = '<span class="status-indicator status-warning"></span>注意が必要です';
            } else {
                statusElement.innerHTML = '<span class="status-indicator status-danger"></span>許容値を超えています';
            }
            
            // 電線サイズ比較更新
            updateCableComparison(type, length, current);
        }
        
        function updateCableComparison(type, length, current) {
            const sizes = [1.6, 2.0, 2.6, 5.5, 8.0, 14, 22, 38];
            const comparison = document.getElementById('cable-comparison');
            comparison.innerHTML = '';
            
            let k;
            switch(type) {
                case 'single2': k = 35.6; break;
                case 'single3': k = 17.8; break;
                case 'three3': k = 30.8; break;
            }
            
            const baseVoltage = type === 'single2' ? 100 : 200;
            
            sizes.forEach(size => {
                const drop = k * length * current / (1000 * size);
                const percent = drop / baseVoltage * 100;
                
                let status, statusClass;
                if (percent <= 2) {
                    status = '推奨';
                    statusClass = 'status-good';
                } else if (percent <= 3) {
                    status = '使用可';
                    statusClass = 'status-warning';
                } else {
                    status = '不適';
                    statusClass = 'status-danger';
                }
                
                const item = document.createElement('div');
                item.className = 'comparison-item';
                item.innerHTML = `
                    <h4>${size} mm²</h4>
                    <p>電圧降下: ${drop.toFixed(1)}V (${percent.toFixed(1)}%)</p>
                    <p><span class="status-indicator ${statusClass}"></span>${status}</p>
                `;
                comparison.appendChild(item);
            });
        }
        
        // 許容電流計算
        const allowableCurrentData = {
            'vvf': {
                '1.6': { air: 19, conduit: 17, bundle: 15 },
                '2.0': { air: 27, conduit: 23, bundle: 19 },
                '2.6': { air: 36, conduit: 31, bundle: 26 },
                '5.5': { air: 58, conduit: 49, bundle: 42 },
                '8': { air: 75, conduit: 63, bundle: 54 },
                '14': { air: 107, conduit: 90, bundle: 77 },
                '22': { air: 139, conduit: 117, bundle: 100 },
                '38': { air: 183, conduit: 154, bundle: 132 }
            },
            'iv': {
                '1.6': { air: 27, conduit: 19, bundle: 17 },
                '2.0': { air: 35, conduit: 25, bundle: 22 },
                '2.6': { air: 48, conduit: 34, bundle: 30 },
                '5.5': { air: 76, conduit: 54, bundle: 48 },
                '8': { air: 99, conduit: 70, bundle: 62 },
                '14': { air: 139, conduit: 99, bundle: 88 },
                '22': { air: 183, conduit: 130, bundle: 115 },
                '38': { air: 257, conduit: 183, bundle: 162 }
            },
            'cv': {
                '2.0': { air: 42, conduit: 31, bundle: 27 },
                '5.5': { air: 86, conduit: 64, bundle: 56 },
                '8': { air: 110, conduit: 82, bundle: 72 },
                '14': { air: 155, conduit: 115, bundle: 101 },
                '22': { air: 205, conduit: 152, bundle: 134 },
                '38': { air: 280, conduit: 208, bundle: 183 }
            },
            'cvt': {
                '2.0': { air: 52, conduit: 37, bundle: 33 },
                '5.5': { air: 105, conduit: 75, bundle: 66 },
                '8': { air: 135, conduit: 96, bundle: 85 },
                '14': { air: 190, conduit: 135, bundle: 120 },
                '22': { air: 250, conduit: 180, bundle: 160 },
                '38': { air: 345, conduit: 245, bundle: 220 }
            }
        };
        
        function updateAllowableCurrent() {
            const cableType = document.getElementById('cable-type').value;
            const size = document.getElementById('cable-size-ac').value;
            const installation = document.getElementById('installation-type').value;
            const temp = parseFloat(document.getElementById('ambient-temp').value);
            const actualCurrent = parseFloat(document.getElementById('actual-current').value);
            
            // 値の更新
            document.getElementById('ambient-temp-value').textContent = temp + '°C';
            document.getElementById('actual-current-value').textContent = actualCurrent + 'A';
            
            // 基準許容電流取得
            let baseCurrent;
            if (allowableCurrentData[cableType] && allowableCurrentData[cableType][size]) {
                const data = allowableCurrentData[cableType][size];
                switch(installation) {
                    case 'air': baseCurrent = data.air; break;
                    case 'conduit': baseCurrent = data.conduit; break;
                    case 'bundle': baseCurrent = data.bundle; break;
                    case 'buried': baseCurrent = data.air * 1.4; break; // 地中は気中の1.4倍程度
                }
            } else {
                baseCurrent = 30; // デフォルト値
            }
            
            // 温度補正
            let tempCorrection = 1.0;
            if (temp > 30) {
                tempCorrection = 1.0 - (temp - 30) * 0.015; // 1℃上昇で1.5%減
            } else if (temp < 30) {
                tempCorrection = 1.0 + (30 - temp) * 0.01; // 1℃低下で1%増
            }
            
            const allowableCurrent = baseCurrent * tempCorrection;
            const usagePercent = actualCurrent / allowableCurrent * 100;
            
            // 結果表示
            document.getElementById('allowable-current').textContent = allowableCurrent.toFixed(0) + ' A';
            document.getElementById('allowable-current-value').textContent = allowableCurrent.toFixed(0) + 'A';
            document.getElementById('used-current-value').textContent = actualCurrent + 'A';
            document.getElementById('usage-percent').textContent = usagePercent.toFixed(1) + ' %';
            document.getElementById('current-percent').textContent = usagePercent.toFixed(0) + '%';
            
            // ゲージ更新
            const gaugeFill = document.getElementById('gauge-fill');
            const dashLength = 471; // 半円の長さ
            const fillLength = dashLength * Math.min(usagePercent / 100, 1);
            gaugeFill.setAttribute('stroke-dasharray', `${fillLength} ${dashLength}`);
            
            // 判定
            const statusElement = document.getElementById('current-status');
            if (usagePercent <= 80) {
                statusElement.innerHTML = '<span class="status-indicator status-good"></span>安全に使用できます';
            } else if (usagePercent <= 100) {
                statusElement.innerHTML = '<span class="status-indicator status-warning"></span>使用率が高いです';
            } else {
                statusElement.innerHTML = '<span class="status-indicator status-danger"></span>許容電流を超えています！';
            }
            
            // 許容電流表更新
            updateAllowableCurrentTable(cableType);
        }
        
        function updateAllowableCurrentTable(cableType) {
            const sizes = ['1.6', '2.0', '2.6', '5.5', '8', '14', '22', '38'];
            const tbody = document.getElementById('allowable-current-table');
            tbody.innerHTML = '';
            
            sizes.forEach(size => {
                if (allowableCurrentData[cableType] && allowableCurrentData[cableType][size]) {
                    const data = allowableCurrentData[cableType][size];
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td style="padding: 0.5rem; border: 1px solid #e0e0e0;">${size}</td>
                        <td style="padding: 0.5rem; border: 1px solid #e0e0e0; text-align: center;">${data.air}A</td>
                        <td style="padding: 0.5rem; border: 1px solid #e0e0e0; text-align: center;">${data.conduit}A</td>
                        <td style="padding: 0.5rem; border: 1px solid #e0e0e0; text-align: center;">${data.bundle}A</td>
                    `;
                }
            });
        }
        
        // 配電方式比較
        function compareDistribution() {
            const type = document.getElementById('compare-distribution').value;
            const voltage = parseFloat(document.getElementById('compare-voltage').value);
            const current = parseFloat(document.getElementById('compare-current').value);
            
            document.getElementById('compare-voltage-value').textContent = voltage + 'V';
            document.getElementById('compare-current-value').textContent = current + 'A';
            
            const resultDiv = document.getElementById('distribution-comparison-result');
            
            if (type === 'all') {
                // 全方式の比較
                const single2Power = voltage * current / 1000;
                const single3Power = voltage * current / 1000;
                const three3Power = Math.sqrt(3) * voltage * current / 1000;
                
                resultDiv.innerHTML = `
                    <div class="comparison-container" style="margin-top: 1rem;">
                        <div style="background: #E8F5E9; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                            <h5>🏠 単相2線式</h5>
                            <p><strong>${single2Power.toFixed(1)} kW</strong></p>
                            <p style="font-size: 0.9rem;">基準値（100%）</p>
                        </div>
                        <div style="background: #E3F2FD; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                            <h5>🏘️ 単相3線式</h5>
                            <p><strong>${single3Power.toFixed(1)} kW</strong> (片側)</p>
                            <p style="font-size: 0.9rem;">両側合計: ${(single3Power * 2).toFixed(1)} kW</p>
                            <p style="color: #1976D2;">効率: 電線3本で2回路分</p>
                        </div>
                        <div style="background: #FFF3E0; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                            <h5>🏭 三相3線式</h5>
                            <p><strong>${three3Power.toFixed(1)} kW</strong></p>
                            <p style="font-size: 0.9rem;">単相比: ${((three3Power / single2Power) * 100).toFixed(0)}%</p>
                            <p style="color: #F57C00;">√3倍（約1.73倍）の電力</p>
                        </div>
                    </div>
                `;
            } else {
                // 個別の方式
                let power, formula;
                switch(type) {
                    case 'single2':
                        power = voltage * current;
                        formula = `P = V × I = ${voltage} × ${current} = ${(power/1000).toFixed(1)} kW`;
                        break;
                    case 'single3':
                        power = voltage * current;
                        formula = `P = V × I = ${voltage} × ${current} = ${(power/1000).toFixed(1)} kW (片側)`;
                        break;
                    case 'three3':
                        power = Math.sqrt(3) * voltage * current;
                        formula = `P = √3 × V × I = 1.732 × ${voltage} × ${current} = ${(power/1000).toFixed(1)} kW`;
                        break;
                }
                
                resultDiv.innerHTML = `
                    <div class="formula">${formula}</div>
                    <p><strong>送電可能電力:</strong> <span class="result-value">${(power/1000).toFixed(1)} kW</span></p>
                    ${type === 'single3' ? '<p><small>※単相3線式は100V/200V両方の負荷に対応可能</small></p>' : ''}
                    ${type === 'three3' ? '<p><small>※三相3線式は同じ電流でより大きな電力を送電可能</small></p>' : ''}
                `;
            }
        }
        
        // 配電方式計算タイプの切り替え
        function updateDistributionCalc() {
            const calcType = document.getElementById('calc-type').value;
            const sections = ['power-calc', 'current-calc', 'efficiency-calc', 'cost-calc'];
            
            sections.forEach(section => {
                document.getElementById(section).style.display = 'none';
            });
            
            document.getElementById(calcType + '-calc').style.display = 'block';
            
            // 初期計算実行
            switch(calcType) {
                case 'power': compareDistribution(); break;
                case 'current': calculateRequiredCurrent(); break;
                case 'efficiency': calculateEfficiency(); break;
                case 'cost': calculateCost(); break;
            }
        }
        
        // 必要電流の計算
        function calculateRequiredCurrent() {
            const power = parseFloat(document.getElementById('required-power').value) * 1000; // kW to W
            document.getElementById('required-power-value').textContent = (power/1000) + 'kW';
            
            const voltage = 200; // 標準電圧
            
            const single2Current = power / voltage;
            const single3Current = power / voltage;
            const three3Current = power / (Math.sqrt(3) * voltage);
            
            const resultDiv = document.getElementById('required-current-result');
            resultDiv.innerHTML = `
                <div class="comparison-container" style="margin-top: 1rem;">
                    <div style="background: #E8F5E9; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                        <h5>単相2線式（${voltage}V）</h5>
                        <p><strong>${single2Current.toFixed(1)} A</strong></p>
                        <p style="font-size: 0.9rem;">必要電線: 2.0mm² (許容27A) → ${single2Current > 27 ? '❌ 不足' : '✅ OK'}</p>
                    </div>
                    <div style="background: #E3F2FD; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                        <h5>単相3線式（${voltage}V）</h5>
                        <p><strong>${single3Current.toFixed(1)} A</strong></p>
                        <p style="font-size: 0.9rem;">各相に分散可能: ${(single3Current/2).toFixed(1)} A</p>
                    </div>
                    <div style="background: #FFF3E0; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                        <h5>三相3線式（${voltage}V）</h5>
                        <p><strong>${three3Current.toFixed(1)} A</strong></p>
                        <p style="font-size: 0.9rem;">単相の${((three3Current/single2Current)*100).toFixed(0)}%で済む</p>
                    </div>
                </div>
            `;
        }
        
        // 送電効率の計算
        function calculateEfficiency() {
            const distance = parseFloat(document.getElementById('transmission-distance').value);
            const power = parseFloat(document.getElementById('transmission-power').value) * 1000;
            
            document.getElementById('transmission-distance-value').textContent = distance + 'm';
            document.getElementById('transmission-power-value').textContent = (power/1000) + 'kW';
            
            const voltage = 200;
            const cableSize = 5.5; // mm²
            
            // 電圧降下計算
            const single2Drop = 35.6 * distance * (power/voltage) / (1000 * cableSize);
            const single3Drop = 17.8 * distance * (power/voltage) / (1000 * cableSize);
            const three3Drop = 30.8 * distance * (power/(Math.sqrt(3)*voltage)) / (1000 * cableSize);
            
            // 損失電力計算
            const single2Loss = single2Drop * (power/voltage) / 1000;
            const single3Loss = single3Drop * (power/voltage) / 1000;
            const three3Loss = three3Drop * (power/(Math.sqrt(3)*voltage)) / 1000;
            
            const resultDiv = document.getElementById('efficiency-result');
            resultDiv.innerHTML = `
                <div class="comparison-container" style="margin-top: 1rem;">
                    <div style="background: #FFEBEE; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                        <h5>単相2線式</h5>
                        <p>電圧降下: <strong>${single2Drop.toFixed(1)}V (${(single2Drop/voltage*100).toFixed(1)}%)</strong></p>
                        <p>損失電力: <strong>${single2Loss.toFixed(2)}kW</strong></p>
                        <p>効率: ${(100 - single2Loss/power*100000).toFixed(1)}%</p>
                    </div>
                    <div style="background: #E3F2FD; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                        <h5>単相3線式</h5>
                        <p>電圧降下: <strong>${single3Drop.toFixed(1)}V (${(single3Drop/voltage*100).toFixed(1)}%)</strong></p>
                        <p>損失電力: <strong>${single3Loss.toFixed(2)}kW</strong></p>
                        <p>効率: ${(100 - single3Loss/power*100000).toFixed(1)}%</p>
                    </div>
                    <div style="background: #E8F5E9; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                        <h5>三相3線式 ✨最高効率</h5>
                        <p>電圧降下: <strong>${three3Drop.toFixed(1)}V (${(three3Drop/voltage*100).toFixed(1)}%)</strong></p>
                        <p>損失電力: <strong>${three3Loss.toFixed(2)}kW</strong></p>
                        <p>効率: ${(100 - three3Loss/power*100000).toFixed(1)}%</p>
                    </div>
                </div>
            `;
        }
        
        // 電気料金の計算
        function calculateCost() {
            const usage = parseFloat(document.getElementById('monthly-usage').value);
            const contract = parseFloat(document.getElementById('contract-power').value);
            
            document.getElementById('monthly-usage-value').textContent = usage + 'kWh';
            document.getElementById('contract-power-value').textContent = contract + 'kW';
            
            // 料金単価（仮定）
            const basicRate = 286; // 円/kW（基本料金）
            const usageRate = 25; // 円/kWh（従量料金）
            const powerBasicRate = 1100; // 円/kW（動力基本料金）
            const powerUsageRate = 17; // 円/kWh（動力従量料金）
            
            // 単相契約の料金
            const singleBasic = contract * basicRate;
            const singleUsage = usage * usageRate;
            const singleTotal = singleBasic + singleUsage;
            
            // 三相（動力）契約の料金
            const threeBasic = contract * powerBasicRate;
            const threeUsage = usage * powerUsageRate;
            const threeTotal = threeBasic + threeUsage;
            
            const resultDiv = document.getElementById('cost-result');
            resultDiv.innerHTML = `
                <div class="comparison-container" style="margin-top: 1rem;">
                    <div style="background: #E3F2FD; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                        <h5>📊 従量電灯契約（単相）</h5>
                        <p>基本料金: ${singleBasic.toLocaleString()}円</p>
                        <p>従量料金: ${singleUsage.toLocaleString()}円</p>
                        <p><strong>合計: ${singleTotal.toLocaleString()}円/月</strong></p>
                    </div>
                    <div style="background: #FFF3E0; padding: 1rem; border-radius: 8px; margin: 0.5rem 0;">
                        <h5>⚡ 動力契約（三相）</h5>
                        <p>基本料金: ${threeBasic.toLocaleString()}円</p>
                        <p>従量料金: ${threeUsage.toLocaleString()}円</p>
                        <p><strong>合計: ${threeTotal.toLocaleString()}円/月</strong></p>
                        <p style="color: ${threeTotal < singleTotal ? '#4CAF50' : '#F44336'};">
                            差額: ${Math.abs(threeTotal - singleTotal).toLocaleString()}円
                            ${threeTotal < singleTotal ? '（お得）' : '（割高）'}
                        </p>
                    </div>
                </div>
                <div class="alert alert-info" style="margin-top: 1rem;">
                    <p>💡 <strong>ポイント:</strong> 動力契約は基本料金が高いですが、使用量が多い場合は従量料金が安いため有利になることがあります。月300kWh以上使用する工場などでは検討の価値があります。</p>
                </div>
            `;
        }
        
        // 初期化
        window.onload = function() {
            updatePowerFactor();
            calculateCapacitor();
            updateVoltageDrop();
            updateAllowableCurrent();
            compareDistribution();
            updateDistributionCalc();
            
            // ゲージの目盛り生成
            const gaugeTicks = document.getElementById('gauge-ticks');
            for (let i = 0; i <= 100; i += 20) {
                const angle = -180 + (i * 1.8);
                const rad = angle * Math.PI / 180;
                const x1 = 300 + 130 * Math.cos(rad);
                const y1 = 250 + 130 * Math.sin(rad);
                const x2 = 300 + 140 * Math.cos(rad);
                const y2 = 250 + 140 * Math.sin(rad);
                
                const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                tick.setAttribute('x1', x1);
                tick.setAttribute('y1', y1);
                tick.setAttribute('x2', x2);
                tick.setAttribute('y2', y2);
                tick.setAttribute('stroke', '#666');
                tick.setAttribute('stroke-width', '2');
                gaugeTicks.appendChild(tick);
                
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', 300 + 160 * Math.cos(rad));
                label.setAttribute('y', 250 + 160 * Math.sin(rad) + 5);
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('font-size', '12');
                label.textContent = i + '%';
                gaugeTicks.appendChild(label);
            }
        };
    </script>
</body>
</html>
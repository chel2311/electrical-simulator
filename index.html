<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±åˆé›»æ°—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #005BAB;
            --primary-dark: #004590;
            --primary-light: #E0EEF9;
            --accent-color: #FF961C;
            --secondary-color: #4D8BC9;
            --bg-color: #f5f5f5;
            --text-color: #333;
            --gray-light: #e0e0e0;
            --gray-medium: #9e9e9e;
            --gray-dark: #616161;
            --red-color: #d32f2f;
            --green-color: #388e3c;
            --yellow-color: #ffc107;
            --blue-light: #e3f2fd;
            --blue-dark: #1e3a8a;
            --wire-red: #ff0000;
            --wire-white: #ffffff;
            --wire-black: #000000;
            --breaker-green: #5cb85c;
            --mlb-color: #ffa366;
            --seismic-color: #e91e63;
            --elcb-color: #9c27b0;
            --grid-tie-color: #2196f3;
            --solar-color: #4caf50;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            
            --border-radius: 8px;
            --padding-standard: 16px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;

            --transition-standard: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', 'Meiryo', system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 20px 0;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            font-size: 24px;
            font-weight: 700;
        }

        /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .tab-nav {
            background-color: white;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 60px;
            z-index: 99;
        }

        .tab-nav-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            gap: 5px;
            overflow-x: auto;
        }

        .tab-nav button {
            background: none;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 15px;
            color: var(--gray-medium);
            transition: var(--transition-standard);
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            font-weight: 500;
        }

        .tab-nav button:hover {
            background-color: rgba(0, 91, 171, 0.05);
        }

        .tab-nav button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background-color: rgba(0, 91, 171, 0.05);
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            min-height: calc(100vh - 120px);
        }

        /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å…±é€šãƒ‘ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
        .panel {
            background: white;
            padding: var(--padding-standard);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
            transition: var(--transition-standard);
        }

        .panel:hover {
            box-shadow: var(--shadow-lg);
        }

        .panel h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 10px;
        }

        /* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition-standard);
            font-weight: 500;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: var(--primary-color);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚°ãƒªãƒƒãƒ‰ */
        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-cols-3 {
            grid-template-columns: 1fr 300px 1fr;
            gap: 24px;
        }

        @media (max-width: 1200px) {
            .grid-cols-3 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .grid-cols-2 {
                grid-template-columns: 1fr;
            }
        }

        /* ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .simulator-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: var(--transition-standard);
            margin-bottom: 20px;
        }

        .simulator-section:hover {
            box-shadow: var(--shadow-lg);
        }

        .section-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 16px 20px;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-header .icon {
            font-size: 18px;
        }

        .section-content {
            padding: 20px;
        }

        /* ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚«ãƒ©ãƒ¼ãƒªãƒ³ã‚° */
        .config-section .section-header {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        }

        .control-section .section-header {
            background: linear-gradient(135deg, var(--accent-color), #ff7043);
        }

        .result-section .section-header {
            background: linear-gradient(135deg, var(--green-color), #4caf50);
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ æ”¹å–„ */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-color);
            font-size: 14px;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--gray-light);
            border-radius: 6px;
            font-size: 14px;
            transition: var(--transition-standard);
            background-color: white;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 91, 171, 0.1);
        }

        .range-value {
            display: inline-block;
            width: 80px;
            text-align: right;
            margin-left: 10px;
            font-weight: 600;
            color: var(--primary-color);
        }

        /* çµæœè¡¨ç¤ºã®æ”¹å–„ */
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .result-card {
            background: rgba(0, 91, 171, 0.05);
            border: 1px solid rgba(0, 91, 171, 0.1);
            border-radius: 8px;
            padding: 16px;
        }

        .result-card h3 {
            color: var(--primary-color);
            font-size: 16px;
            margin-bottom: 12px;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 8px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 91, 171, 0.1);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-value {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 14px;
        }

        /* ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤ºã®æ”¹å–„ */
        .chart-container {
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            padding: 20px;
            margin-bottom: 20px;
        }

        .chart-container h3 {
            color: var(--primary-color);
            margin-bottom: 16px;
            text-align: center;
            font-size: 16px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* åˆ¶å¾¡ãƒœã‚¿ãƒ³ã®æ”¹å–„ */
        .control-center {
            text-align: center;
            padding: 24px;
        }

        .calculate-btn {
            background: linear-gradient(135deg, var(--accent-color), #ff7043);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-standard);
            box-shadow: var(--shadow-md);
            min-width: 200px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, #ff7043, var(--accent-color));
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--gray-light);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* æƒ…å ±ãƒ‘ãƒãƒ« */
        .info-panel {
            background: linear-gradient(135deg, #fff3e0, #ffecb3);
            border: 1px solid #ffcc80;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            font-size: 14px;
            line-height: 1.5;
        }

        .info-panel strong {
            color: var(--primary-dark);
        }

        /* ãƒ‘ãƒãƒ«é…ç½®å›³ã®æ”¹å–„ */
        .panel-grid {
            background: #f8f8f8;
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
        }

        .string-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .string-label {
            font-weight: 600;
            color: var(--primary-color);
            min-width: 80px;
        }

        .panel-unit {
            width: 32px;
            height: 22px;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            border: 1px solid #2E7D32;
            border-radius: 3px;
            display: inline-block;
            margin: 1px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .string-info {
            font-size: 13px;
            color: var(--gray-dark);
            margin-left: auto;
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ */
        .current-path {
            stroke-dasharray: 5;
            animation: flow 0.5s linear infinite;
        }

        @keyframes flow {
            to {
                stroke-dashoffset: -10;
            }
        }

        /* SVGã‚³ãƒ³ãƒ†ãƒŠ */
        .svg-container {
            width: 100%;
            overflow: auto;
            position: relative;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            background-color: #f8f8f8;
            min-height: 400px;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º */
        .loading {
            text-align: center;
            padding: 50px;
            color: var(--gray-medium);
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(3, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .placeholder-message {
            text-align: center;
            padding: 100px 20px;
            color: var(--gray-medium);
            font-size: 18px;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>çµ±åˆé›»æ°—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="resetAll()">å…¨ã¦ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>
    </header>

    <nav class="tab-nav">
        <div class="tab-nav-content">
            <button class="tab-btn active" onclick="showTab('circuit-rich')" data-tab="circuit-rich">
                å›è·¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
            </button>
            <button class="tab-btn" onclick="showTab('circuit-config')" data-tab="circuit-config">
                åˆ†é›»ç›¤å›è·¯æ§‹æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
            </button>
            <button class="tab-btn" onclick="showTab('breaker')" data-tab="breaker">
                åˆ†é›»ç›¤ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼é®æ–­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
            </button>
            <button class="tab-btn" onclick="showTab('solar')" data-tab="solar">
                å¤ªé™½å…‰ç™ºé›»ã‚·ã‚¹ãƒ†ãƒ 
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- å›è·¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆãƒªãƒƒãƒç‰ˆï¼‰ -->
        <div id="circuit-rich" class="tab-content active">
            <div class="panel">
                <h2>å›è·¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                <p>é›»æ°—å›è·¯ã®åŸºç¤ã‚’å­¦ç¿’ã—ã€å®Ÿéš›ã®é…ç·šã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã§ãã¾ã™ã€‚</p>
                <iframe src="circuit-simulator-rich.html" 
                        style="width: 100%; height: 800px; border: 1px solid var(--gray-light); border-radius: var(--border-radius);"
                        title="å›è·¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼"
                        sandbox="allow-scripts allow-same-origin allow-forms">
                    <p>ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯iframeãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<a href="circuit-simulator-rich.html" target="_blank">ã“ã¡ã‚‰ã‹ã‚‰ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹</a>ã—ã¦ãã ã•ã„ã€‚</p>
                </iframe>
            </div>
        </div>

        <!-- åˆ†é›»ç›¤å›è·¯æ§‹æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ -->
        <div id="circuit-config" class="tab-content">
            <div class="panel">
                <h2>åˆ†é›»ç›¤å›è·¯æ§‹æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                <p>ä½å®…åˆ†é›»ç›¤ã®å›è·¯æ§‹æˆã‚’å­¦ç¿’ã—ã€è¨­è¨ˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã§ãã¾ã™ã€‚</p>
                <iframe src="distribution-board-simulator.html" 
                        style="width: 100%; height: 800px; border: 1px solid var(--gray-light); border-radius: var(--border-radius);"
                        title="åˆ†é›»ç›¤å›è·¯æ§‹æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼"
                        sandbox="allow-scripts allow-same-origin allow-forms">
                    <p>ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯iframeãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<a href="distribution-board-simulator.html" target="_blank">ã“ã¡ã‚‰ã‹ã‚‰ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹</a>ã—ã¦ãã ã•ã„ã€‚</p>
                </iframe>
            </div>
        </div>

        <!-- ä½å®…åˆ†é›»ç›¤ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼é®æ–­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ -->
        <div id="breaker" class="tab-content">
            <div class="panel">
                <h2>åˆ†é›»ç›¤ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼é®æ–­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                <p>ä½å®…åˆ†é›»ç›¤ã®ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼å‹•ä½œã‚’å­¦ç¿’ã—ã€é®æ–­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã§ãã¾ã™ã€‚</p>
                <iframe src="residential-breaker-simulator.html" 
                        style="width: 100%; height: 800px; border: 1px solid var(--gray-light); border-radius: var(--border-radius);"
                        title="ä½å®…åˆ†é›»ç›¤ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼é®æ–­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼"
                        sandbox="allow-scripts allow-same-origin allow-forms">
                    <p>ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯iframeãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<a href="residential-breaker-simulator.html" target="_blank">ã“ã¡ã‚‰ã‹ã‚‰ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹</a>ã—ã¦ãã ã•ã„ã€‚</p>
                </iframe>
            </div>
        </div>

        <!-- å¤ªé™½å…‰ç™ºé›»ã‚·ã‚¹ãƒ†ãƒ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ -->
        <div id="solar" class="tab-content">
            <div class="panel">
                <h2>å¤ªé™½å…‰ç™ºé›»ã‚·ã‚¹ãƒ†ãƒ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                <p>å¤ªé™½å…‰ç™ºé›»ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆã¨å‹•ä½œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã§ãã¾ã™ã€‚åœ°åŸŸã®æ—¥ç…§æ¡ä»¶ã‹ã‚‰æœ€é©ãªã‚·ã‚¹ãƒ†ãƒ æ§‹æˆã‚’è¨ˆç®—ã—ã¾ã™ã€‚</p>
            </div>
            
            <!-- å¤ªé™½å…‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å†…å®¹ï¼ˆ3ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ -->
            <div class="grid grid-cols-3">
                <!-- å·¦å´ï¼šè¨­å®šãƒ‘ãƒãƒ« -->
                <div class="config-column">
                    <div class="simulator-section config-section">
                        <div class="section-header">
                            <span class="icon">ğŸŒ</span>
                            è¨­ç½®åœ°åŸŸæƒ…å ±
                        </div>
                        <div class="section-content">
                            <div class="form-group">
                                <label for="prefecture-solar">éƒ½é“åºœçœŒ:</label>
                                <select id="prefecture-solar">
                                    <option value="">éƒ½é“åºœçœŒã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                                    <optgroup label="åŒ—æµ·é“ãƒ»æ±åŒ—">
                                        <option value="åŒ—æµ·é“">åŒ—æµ·é“</option>
                                        <option value="é’æ£®çœŒ">é’æ£®çœŒ</option>
                                        <option value="å²©æ‰‹çœŒ">å²©æ‰‹çœŒ</option>
                                        <option value="å®®åŸçœŒ">å®®åŸçœŒ</option>
                                        <option value="ç§‹ç”°çœŒ">ç§‹ç”°çœŒ</option>
                                        <option value="å±±å½¢çœŒ">å±±å½¢çœŒ</option>
                                        <option value="ç¦å³¶çœŒ">ç¦å³¶çœŒ</option>
                                    </optgroup>
                                    <optgroup label="é–¢æ±">
                                        <option value="èŒ¨åŸçœŒ">èŒ¨åŸçœŒ</option>
                                        <option value="æ ƒæœ¨çœŒ">æ ƒæœ¨çœŒ</option>
                                        <option value="ç¾¤é¦¬çœŒ">ç¾¤é¦¬çœŒ</option>
                                        <option value="åŸ¼ç‰çœŒ">åŸ¼ç‰çœŒ</option>
                                        <option value="åƒè‘‰çœŒ">åƒè‘‰çœŒ</option>
                                        <option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option>
                                        <option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option>
                                    </optgroup>
                                    <optgroup label="ä¸­éƒ¨">
                                        <option value="æ–°æ½ŸçœŒ">æ–°æ½ŸçœŒ</option>
                                        <option value="å¯Œå±±çœŒ">å¯Œå±±çœŒ</option>
                                        <option value="çŸ³å·çœŒ">çŸ³å·çœŒ</option>
                                        <option value="ç¦äº•çœŒ">ç¦äº•çœŒ</option>
                                        <option value="å±±æ¢¨çœŒ">å±±æ¢¨çœŒ</option>
                                        <option value="é•·é‡çœŒ">é•·é‡çœŒ</option>
                                        <option value="å²é˜œçœŒ">å²é˜œçœŒ</option>
                                        <option value="é™å²¡çœŒ">é™å²¡çœŒ</option>
                                        <option value="æ„›çŸ¥çœŒ">æ„›çŸ¥çœŒ</option>
                                    </optgroup>
                                    <optgroup label="è¿‘ç•¿">
                                        <option value="ä¸‰é‡çœŒ">ä¸‰é‡çœŒ</option>
                                        <option value="æ»‹è³€çœŒ">æ»‹è³€çœŒ</option>
                                        <option value="äº¬éƒ½åºœ">äº¬éƒ½åºœ</option>
                                        <option value="å¤§é˜ªåºœ">å¤§é˜ªåºœ</option>
                                        <option value="å…µåº«çœŒ">å…µåº«çœŒ</option>
                                        <option value="å¥ˆè‰¯çœŒ">å¥ˆè‰¯çœŒ</option>
                                        <option value="å’Œæ­Œå±±çœŒ">å’Œæ­Œå±±çœŒ</option>
                                    </optgroup>
                                    <optgroup label="ä¸­å›½">
                                        <option value="é³¥å–çœŒ">é³¥å–çœŒ</option>
                                        <option value="å³¶æ ¹çœŒ">å³¶æ ¹çœŒ</option>
                                        <option value="å²¡å±±çœŒ">å²¡å±±çœŒ</option>
                                        <option value="åºƒå³¶çœŒ">åºƒå³¶çœŒ</option>
                                        <option value="å±±å£çœŒ">å±±å£çœŒ</option>
                                    </optgroup>
                                    <optgroup label="å››å›½">
                                        <option value="å¾³å³¶çœŒ">å¾³å³¶çœŒ</option>
                                        <option value="é¦™å·çœŒ">é¦™å·çœŒ</option>
                                        <option value="æ„›åª›çœŒ">æ„›åª›çœŒ</option>
                                        <option value="é«˜çŸ¥çœŒ">é«˜çŸ¥çœŒ</option>
                                    </optgroup>
                                    <optgroup label="ä¹å·ãƒ»æ²–ç¸„">
                                        <option value="ç¦å²¡çœŒ">ç¦å²¡çœŒ</option>
                                        <option value="ä½è³€çœŒ">ä½è³€çœŒ</option>
                                        <option value="é•·å´çœŒ">é•·å´çœŒ</option>
                                        <option value="ç†Šæœ¬çœŒ">ç†Šæœ¬çœŒ</option>
                                        <option value="å¤§åˆ†çœŒ">å¤§åˆ†çœŒ</option>
                                        <option value="å®®å´çœŒ">å®®å´çœŒ</option>
                                        <option value="é¹¿å…å³¶çœŒ">é¹¿å…å³¶çœŒ</option>
                                        <option value="æ²–ç¸„çœŒ">æ²–ç¸„çœŒ</option>
                                    </optgroup>
                                </select>
                            </div>
                            
                            <div id="locationInfoPanel-solar" class="info-panel" style="display:none;">
                                <strong>åœ°åŸŸæƒ…å ±:</strong><br>
                                å¹´é–“æ—¥ç…§æ™‚é–“: <span id="annualSunshineHours-solar">-</span> æ™‚é–“<br>
                                å…¨å›½å¹³å‡ã¨ã®æ¯”: <span id="sunshineRatio-solar">-</span>%<br>
                                <small>â€»ã“ã®åœ°åŸŸã®æ—¥ç…§ç‰¹æ€§ãŒç™ºé›»é‡è¨ˆç®—ã«åæ˜ ã•ã‚Œã¾ã™</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="simulator-section config-section">
                        <div class="section-header">
                            <span class="icon">âš¡</span>
                            ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
                        </div>
                        <div class="section-content">
                            <div class="form-group">
                                <label for="panelPower-solar">ãƒ‘ãƒãƒ«å®šæ ¼å‡ºåŠ› (W):</label>
                                <input type="number" id="panelPower-solar" min="100" max="1000" value="330">
                            </div>
                            
                            <div class="form-group">
                                <label for="panelEfficiency-solar">ãƒ‘ãƒãƒ«å¤‰æ›åŠ¹ç‡ (%):</label>
                                <input type="number" id="panelEfficiency-solar" min="15" max="25" step="0.1" value="19.5">
                            </div>
                            
                            <div class="form-group">
                                <label for="panelCount-solar">ãƒ‘ãƒãƒ«æšæ•°:</label>
                                <input type="number" id="panelCount-solar" min="1" max="100" value="12">
                            </div>
                            
                            <div class="form-group">
                                <label for="stringCount-solar">ã‚¹ãƒˆãƒªãƒ³ã‚°æ•°:</label>
                                <input type="number" id="stringCount-solar" min="1" max="10" value="3">
                            </div>
                        </div>
                    </div>
                    
                    <div class="simulator-section config-section">
                        <div class="section-header">
                            <span class="icon">ğŸŒ¤ï¸</span>
                            ç’°å¢ƒæ¡ä»¶
                        </div>
                        <div class="section-content">
                            <div class="form-group">
                                <label for="weatherCondition-solar">å¤©å€™æ¡ä»¶:</label>
                                <select id="weatherCondition-solar">
                                    <option value="æ™´ã‚Œ">â˜€ï¸ æ™´ã‚Œ</option>
                                    <option value="è–„æ›‡ã‚Š">â›… è–„æ›‡ã‚Š</option>
                                    <option value="æ›‡ã‚Š">â˜ï¸ æ›‡ã‚Š</option>
                                    <option value="é›¨">ğŸŒ§ï¸ é›¨</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="temperature-solar">å‘¨å›²æ¸©åº¦ (â„ƒ):</label>
                                <input type="range" id="temperature-solar" min="-10" max="50" value="25" step="1">
                                <span id="temperatureValue-solar" class="range-value">25â„ƒ</span>
                            </div>
                            
                            <div class="form-group">
                                <label for="tiltAngle-solar">ãƒ‘ãƒãƒ«å‚¾æ–œè§’ (Â°):</label>
                                <input type="range" id="tiltAngle-solar" min="0" max="90" value="30" step="1">
                                <span id="tiltAngleValue-solar" class="range-value">30Â°</span>
                            </div>
                            
                            <div class="form-group">
                                <label for="orientationAngle-solar">æ–¹ä½è§’ (Â°):</label>
                                <input type="range" id="orientationAngle-solar" min="-90" max="90" value="0" step="1">
                                <span id="orientationAngleValue-solar" class="range-value">0Â° (çœŸå—)</span>
                            </div>
                        </div>
                    </div>
                </div>
            
                <!-- ä¸­å¤®ï¼šåˆ¶å¾¡ãƒ‘ãƒãƒ« -->
                <div class="control-column">
                    <div class="simulator-section control-section">
                        <div class="section-header">
                            <span class="icon">ğŸ”§</span>
                            ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡
                        </div>
                        <div class="section-content">
                            <div class="control-center">
                                <button id="calculateBtn-solar" class="calculate-btn">
                                    âš¡ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
                                </button>
                                <div class="loading-overlay" id="loadingOverlay-solar" style="display: none;">
                                    <div class="spinner"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ -->
                    <div class="simulator-section control-section">
                        <div class="section-header">
                            <span class="icon">ğŸ“Š</span>
                            ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³
                        </div>
                        <div class="section-content">
                            <div id="solarPanelVisualization-solar">
                                <div id="panelGridContainer-solar" class="panel-grid">
                                    <p style="color: var(--gray-medium); text-align: center; margin: 40px 0;">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¾Œã«ãƒ‘ãƒãƒ«é…ç½®å›³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <!-- å³å´ï¼šçµæœãƒ‘ãƒãƒ« -->
                <div class="result-column">
                    <div class="simulator-section result-section">
                        <div class="section-header">
                            <span class="icon">ğŸ“ˆ</span>
                            ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ
                        </div>
                        <div class="section-content">
                            <div class="result-grid">
                                <div class="result-card">
                                    <h3>ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h3>
                                    <div class="result-item">
                                        <span>ã‚·ã‚¹ãƒ†ãƒ å®¹é‡:</span>
                                        <span id="systemCapacity-solar" class="result-value">-</span>
                                    </div>
                                    <div class="result-item">
                                        <span>ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æšæ•°:</span>
                                        <span id="modulesCount-solar" class="result-value">-</span>
                                    </div>
                                    <div class="result-item">
                                        <span>ã‚¹ãƒˆãƒªãƒ³ã‚°æ•°:</span>
                                        <span id="stringsCount-solar" class="result-value">-</span>
                                    </div>
                                </div>
                                
                                <div class="result-card">
                                    <h3>ç™ºé›»é‡äºˆæ¸¬</h3>
                                    <div class="result-item">
                                        <span>ç™ºé›»é›»åŠ›ï¼ˆç¬æ™‚ï¼‰:</span>
                                        <span id="instantPower-solar" class="result-value">-</span>
                                    </div>
                                    <div class="result-item">
                                        <span>æ—¥é–“ç™ºé›»é‡:</span>
                                        <span id="dailyGeneration-solar" class="result-value">-</span>
                                    </div>
                                    <div class="result-item">
                                        <span>æœˆé–“ç™ºé›»é‡:</span>
                                        <span id="monthlyGeneration-solar" class="result-value">-</span>
                                    </div>
                                    <div class="result-item">
                                        <span>å¹´é–“ç™ºé›»é‡:</span>
                                        <span id="yearlyGeneration-solar" class="result-value">-</span>
                                    </div>
                                </div>
                                
                                <div class="result-card">
                                    <h3>åŠ¹ç‡ä¿‚æ•°</h3>
                                    <div class="result-item">
                                        <span>åœ°åŸŸæ—¥ç…§ä¿‚æ•°:</span>
                                        <span id="regionalSunshineFactor-solar" class="result-value">-</span>
                                    </div>
                                    <div class="result-item">
                                        <span>å¤©å€™ã®å½±éŸ¿:</span>
                                        <span id="weatherFactor-solar" class="result-value">-</span>
                                    </div>
                                    <div class="result-item">
                                        <span>è¨­ç½®è§’åº¦ã®å½±éŸ¿:</span>
                                        <span id="orientationFactor-solar" class="result-value">-</span>
                                    </div>
                                    <div class="result-item">
                                        <span>æ¸©åº¦ã®å½±éŸ¿:</span>
                                        <span id="temperatureFactor-solar" class="result-value">-</span>
                                    </div>
                                    <div class="result-item">
                                        <span>ã‚·ã‚¹ãƒ†ãƒ åŠ¹ç‡:</span>
                                        <span id="totalEfficiency-solar" class="result-value">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ã‚°ãƒ©ãƒ•è¡¨ç¤ºéƒ¨åˆ† -->
                    <div class="chart-container">
                        <h3>æœˆåˆ¥ç™ºé›»é‡äºˆæ¸¬</h3>
                        <div class="chart-wrapper">
                            <canvas id="monthlyChart-solar"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>åŠ¹ç‡ãƒ­ã‚¹åˆ†æ</h3>
                        <div class="chart-wrapper">
                            <canvas id="lossChart-solar"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function showTab(tabId) {
            console.log(`Switching to tab: ${tabId}`);
            
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
            const allTabs = document.querySelectorAll('.tab-content');
            allTabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
            const allButtons = document.querySelectorAll('.tab-btn');
            allButtons.forEach(btn => {
                btn.classList.remove('active');
            });

            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.classList.add('active');
                console.log(`Activated tab: ${tabId}`);
            } else {
                console.error(`Tab not found: ${tabId}`);
            }

            // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
            event.target.classList.add('active');
        }

        // ã‚¿ãƒ–åã‚’å–å¾—
        function getTabName(tabId) {
            const tabNames = {
                'breaker': 'ä½å®…åˆ†é›»ç›¤ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼',
                'circuit-config': 'åˆ†é›»ç›¤å›è·¯æ§‹æˆ',
                'circuit-rich': 'å›è·¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼',
                'solar': 'å¤ªé™½å…‰ç™ºé›»ã‚·ã‚¹ãƒ†ãƒ '
            };
            return tabNames[tabId] || '';
        }

        // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚€ï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰
        function loadTabContent(tabId) {
            console.log(`Loading content for: ${tabId}`);
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã“ã“ã§å„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’
            // å‹•çš„ã«èª­ã¿è¾¼ã‚“ã§è¡¨ç¤ºã—ã¾ã™
        }

        // å…¨ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
        function resetAll() {
            if (confirm('ã™ã¹ã¦ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                // å„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®ãƒªã‚»ãƒƒãƒˆå‡¦ç†
                console.log('Resetting all simulators...');
                location.reload();
            }
        }

        // å¤ªé™½å…‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼æ©Ÿèƒ½
        const SolarSimulator = {
            // éƒ½é“åºœçœŒåˆ¥æ—¥ç…§æ™‚é–“ãƒ‡ãƒ¼ã‚¿ï¼ˆ1991-2020å¹´å¹³å¹´å€¤ï¼‰
            prefectureSunshineData: {
                'åŒ—æµ·é“': { hours: 1740.4, ratio: 0.908 },
                'é’æ£®çœŒ': { hours: 1589.2, ratio: 0.829 },
                'å²©æ‰‹çœŒ': { hours: 1667.5, ratio: 0.870 },
                'å®®åŸçœŒ': { hours: 1796.1, ratio: 0.937 },
                'ç§‹ç”°çœŒ': { hours: 1527.4, ratio: 0.797 },
                'å±±å½¢çœŒ': { hours: 1617.9, ratio: 0.844 },
                'ç¦å³¶çœŒ': { hours: 1766.4, ratio: 0.922 },
                'èŒ¨åŸçœŒ': { hours: 1897.2, ratio: 0.990 },
                'æ ƒæœ¨çœŒ': { hours: 1938.4, ratio: 1.011 },
                'ç¾¤é¦¬çœŒ': { hours: 2153.7, ratio: 1.124 },
                'åŸ¼ç‰çœŒ': { hours: 2056.6, ratio: 1.073 },
                'åƒè‘‰çœŒ': { hours: 1851.5, ratio: 0.966 },
                'æ±äº¬éƒ½': { hours: 1881.3, ratio: 0.982 },
                'ç¥å¥ˆå·çœŒ': { hours: 2020.5, ratio: 1.054 },
                'æ–°æ½ŸçœŒ': { hours: 1639.6, ratio: 0.856 },
                'å¯Œå±±çœŒ': { hours: 1647.2, ratio: 0.860 },
                'çŸ³å·çœŒ': { hours: 1680.9, ratio: 0.877 },
                'ç¦äº•çœŒ': { hours: 1689.4, ratio: 0.882 },
                'å±±æ¢¨çœŒ': { hours: 2225.8, ratio: 1.162 },
                'é•·é‡çœŒ': { hours: 2061.0, ratio: 1.076 },
                'å²é˜œçœŒ': { hours: 2108.6, ratio: 1.101 },
                'é™å²¡çœŒ': { hours: 2151.5, ratio: 1.123 },
                'æ„›çŸ¥çœŒ': { hours: 2141.0, ratio: 1.118 },
                'ä¸‰é‡çœŒ': { hours: 2030.5, ratio: 1.060 },
                'æ»‹è³€çœŒ': { hours: 1832.4, ratio: 0.956 },
                'äº¬éƒ½åºœ': { hours: 1851.4, ratio: 0.966 },
                'å¤§é˜ªåºœ': { hours: 1996.3, ratio: 1.042 },
                'å…µåº«çœŒ': { hours: 2044.1, ratio: 1.067 },
                'å¥ˆè‰¯çœŒ': { hours: 1990.7, ratio: 1.039 },
                'å’Œæ­Œå±±çœŒ': { hours: 2116.9, ratio: 1.105 },
                'é³¥å–çœŒ': { hours: 1707.0, ratio: 0.891 },
                'å³¶æ ¹çœŒ': { hours: 1720.5, ratio: 0.898 },
                'å²¡å±±çœŒ': { hours: 2089.5, ratio: 1.091 },
                'åºƒå³¶çœŒ': { hours: 2033.2, ratio: 1.061 },
                'å±±å£çœŒ': { hours: 1956.6, ratio: 1.021 },
                'å¾³å³¶çœŒ': { hours: 2092.6, ratio: 1.092 },
                'é¦™å·çœŒ': { hours: 2085.2, ratio: 1.089 },
                'æ„›åª›çœŒ': { hours: 2017.4, ratio: 1.053 },
                'é«˜çŸ¥çœŒ': { hours: 2159.7, ratio: 1.127 },
                'ç¦å²¡çœŒ': { hours: 1869.0, ratio: 0.975 },
                'ä½è³€çœŒ': { hours: 1852.4, ratio: 0.967 },
                'é•·å´çœŒ': { hours: 1861.4, ratio: 0.971 },
                'ç†Šæœ¬çœŒ': { hours: 1925.3, ratio: 1.005 },
                'å¤§åˆ†çœŒ': { hours: 1928.0, ratio: 1.006 },
                'å®®å´çœŒ': { hours: 2121.7, ratio: 1.107 },
                'é¹¿å…å³¶çœŒ': { hours: 1935.6, ratio: 1.010 },
                'æ²–ç¸„çœŒ': { hours: 1812.9, ratio: 0.946 }
            },

            config: {
                prefecture: '',
                regionalSunshineFactor: 1.0,
                panelCount: 12,
                panelPower: 330,
                panelEfficiency: 19.5,
                stringCount: 3,
                weatherCondition: 'æ™´ã‚Œ',
                temperature: 25,
                tiltAngle: 30,
                orientationAngle: 0
            },

            results: {
                totalCapacity: 0,
                instantPower: 0,
                dailyGeneration: 0,
                monthlyGeneration: 0,
                yearlyGeneration: 0,
                totalEfficiency: 0,
                regionalSunshineFactor: 100,
                weatherFactor: 100,
                orientationFactor: 100,
                temperatureFactor: 100,
                monthlyGenerations: []
            },

            charts: {
                monthly: null,
                loss: null
            },

            // åˆæœŸåŒ–
            init: function() {
                this.setupEventListeners();
                this.calculate();
            },

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
            setupEventListeners: function() {
                const self = this;

                // éƒ½é“åºœçœŒé¸æŠ
                document.getElementById('prefecture-solar').addEventListener('change', function() {
                    self.config.prefecture = this.value;
                    self.updateLocationInfo();
                });

                // ãƒ‘ãƒãƒ«è¨­å®š
                document.getElementById('panelPower-solar').addEventListener('change', function() {
                    self.config.panelPower = parseInt(this.value) || 330;
                });

                document.getElementById('panelEfficiency-solar').addEventListener('change', function() {
                    self.config.panelEfficiency = parseFloat(this.value) || 19.5;
                });

                document.getElementById('panelCount-solar').addEventListener('change', function() {
                    self.config.panelCount = parseInt(this.value) || 12;
                });

                document.getElementById('stringCount-solar').addEventListener('change', function() {
                    self.config.stringCount = parseInt(this.value) || 3;
                });

                // ç’°å¢ƒæ¡ä»¶
                document.getElementById('weatherCondition-solar').addEventListener('change', function() {
                    self.config.weatherCondition = this.value;
                });

                document.getElementById('temperature-solar').addEventListener('input', function() {
                    self.config.temperature = parseInt(this.value) || 25;
                    document.getElementById('temperatureValue-solar').textContent = self.config.temperature + 'â„ƒ';
                });

                document.getElementById('tiltAngle-solar').addEventListener('input', function() {
                    self.config.tiltAngle = parseInt(this.value) || 30;
                    document.getElementById('tiltAngleValue-solar').textContent = self.config.tiltAngle + 'Â°';
                });

                document.getElementById('orientationAngle-solar').addEventListener('input', function() {
                    self.config.orientationAngle = parseInt(this.value) || 0;
                    let text = self.config.orientationAngle + 'Â°';
                    if (self.config.orientationAngle === 0) {
                        text += ' (çœŸå—)';
                    } else if (self.config.orientationAngle < 0) {
                        text += ` (æ±${Math.abs(self.config.orientationAngle)}Â°)`;
                    } else {
                        text += ` (è¥¿${self.config.orientationAngle}Â°)`;
                    }
                    document.getElementById('orientationAngleValue-solar').textContent = text;
                });

                // è¨ˆç®—ãƒœã‚¿ãƒ³
                document.getElementById('calculateBtn-solar').addEventListener('click', function() {
                    self.calculate();
                    self.updateCharts();
                    self.renderPanelGrid();
                });
            },

            // åœ°åŸŸæƒ…å ±ã®æ›´æ–°
            updateLocationInfo: function() {
                const panel = document.getElementById('locationInfoPanel-solar');
                const hoursEl = document.getElementById('annualSunshineHours-solar');
                const ratioEl = document.getElementById('sunshineRatio-solar');

                if (this.config.prefecture && this.prefectureSunshineData[this.config.prefecture]) {
                    const data = this.prefectureSunshineData[this.config.prefecture];
                    this.config.regionalSunshineFactor = data.ratio;
                    
                    panel.style.display = 'block';
                    hoursEl.textContent = data.hours.toFixed(1);
                    ratioEl.textContent = (data.ratio * 100).toFixed(1);
                } else {
                    panel.style.display = 'none';
                    this.config.regionalSunshineFactor = 1.0;
                }
            },

            // è¨ˆç®—å®Ÿè¡Œ
            calculate: function() {
                // ã‚·ã‚¹ãƒ†ãƒ å®¹é‡è¨ˆç®—
                const totalCapacity = (this.config.panelCount * this.config.panelPower) / 1000;

                // å¤©å€™ä¿‚æ•°
                const weatherFactors = {
                    'æ™´ã‚Œ': 1.0,
                    'è–„æ›‡ã‚Š': 0.7,
                    'æ›‡ã‚Š': 0.4,
                    'é›¨': 0.2
                };
                const weatherFactor = weatherFactors[this.config.weatherCondition] || 0.7;

                // æ–¹ä½ãƒ»å‚¾æ–œè§’ã®å½±éŸ¿
                const orientationFactor = this.calculateOrientationFactor();

                // æ¸©åº¦ã®å½±éŸ¿
                const temperatureFactor = this.calculateTemperatureFactor();

                // ã‚·ã‚¹ãƒ†ãƒ åŠ¹ç‡ï¼ˆé…ç·šæå¤±ã€ãƒŸã‚¹ãƒãƒƒãƒãªã©ï¼‰
                const systemEfficiency = 0.95;

                // ç¬æ™‚ç™ºé›»é›»åŠ›
                const instantPower = totalCapacity * weatherFactor * orientationFactor * temperatureFactor * systemEfficiency;

                // æ—¥ç…§æ™‚é–“
                const baseDailySunHours = {
                    "æ™´ã‚Œ": 5.0,
                    "è–„æ›‡ã‚Š": 4.0,
                    "æ›‡ã‚Š": 3.0,
                    "é›¨": 1.5
                };
                const dailySunHours = baseDailySunHours[this.config.weatherCondition] * this.config.regionalSunshineFactor;

                // ç™ºé›»é‡è¨ˆç®—
                const dailyGeneration = instantPower * dailySunHours;
                const monthlyGeneration = dailyGeneration * 30;

                // æœˆåˆ¥ç™ºé›»é‡ã®è¨ˆç®—
                const monthlyMultipliers = [0.7, 0.8, 0.9, 1.0, 1.05, 0.9, 1.0, 1.0, 0.85, 0.8, 0.7, 0.65];
                const monthlyGenerations = monthlyMultipliers.map(mult => monthlyGeneration * mult);
                const yearlyGeneration = monthlyGenerations.reduce((sum, val) => sum + val, 0);

                // ç·åˆåŠ¹ç‡
                const totalEfficiency = weatherFactor * orientationFactor * temperatureFactor * systemEfficiency;

                // çµæœã‚’ä¿å­˜
                this.results = {
                    totalCapacity,
                    instantPower,
                    dailyGeneration,
                    monthlyGeneration,
                    yearlyGeneration,
                    totalEfficiency: totalEfficiency * 100,
                    regionalSunshineFactor: this.config.regionalSunshineFactor * 100,
                    weatherFactor: weatherFactor * 100,
                    orientationFactor: orientationFactor * 100,
                    temperatureFactor: temperatureFactor * 100,
                    monthlyGenerations
                };

                this.displayResults();
            },

            // æ–¹ä½ãƒ»å‚¾æ–œè§’ã®å½±éŸ¿è¨ˆç®—
            calculateOrientationFactor: function() {
                const optimalTiltAngle = 30;
                let tiltEfficiency = 1.0 - Math.abs(this.config.tiltAngle - optimalTiltAngle) * 0.005;
                if (tiltEfficiency < 0.7) tiltEfficiency = 0.7;

                let orientationEfficiency = 1.0 - Math.abs(this.config.orientationAngle) * 0.002;
                if (orientationEfficiency < 0.8) orientationEfficiency = 0.8;

                return tiltEfficiency * orientationEfficiency;
            },

            // æ¸©åº¦ã®å½±éŸ¿è¨ˆç®—
            calculateTemperatureFactor: function() {
                const temperatureCoefficient = -0.004;
                return 1 + temperatureCoefficient * (this.config.temperature - 25);
            },

            // çµæœè¡¨ç¤º
            displayResults: function() {
                document.getElementById('systemCapacity-solar').textContent = this.results.totalCapacity.toFixed(2) + ' kW';
                document.getElementById('modulesCount-solar').textContent = this.config.panelCount + ' æš';
                document.getElementById('stringsCount-solar').textContent = this.config.stringCount + ' ç³»çµ±';
                document.getElementById('instantPower-solar').textContent = this.results.instantPower.toFixed(2) + ' kW';
                document.getElementById('dailyGeneration-solar').textContent = this.results.dailyGeneration.toFixed(2) + ' kWh';
                document.getElementById('monthlyGeneration-solar').textContent = this.results.monthlyGeneration.toFixed(2) + ' kWh';
                document.getElementById('yearlyGeneration-solar').textContent = this.results.yearlyGeneration.toFixed(2) + ' kWh';
                document.getElementById('regionalSunshineFactor-solar').textContent = this.results.regionalSunshineFactor.toFixed(1) + '%';
                document.getElementById('weatherFactor-solar').textContent = this.results.weatherFactor.toFixed(1) + '%';
                document.getElementById('orientationFactor-solar').textContent = this.results.orientationFactor.toFixed(1) + '%';
                document.getElementById('temperatureFactor-solar').textContent = this.results.temperatureFactor.toFixed(1) + '%';
                document.getElementById('totalEfficiency-solar').textContent = this.results.totalEfficiency.toFixed(1) + '%';
            },

            // ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
            updateCharts: function() {
                this.updateMonthlyChart();
                this.updateLossChart();
            },

            // æœˆåˆ¥ç™ºé›»é‡ãƒãƒ£ãƒ¼ãƒˆ
            updateMonthlyChart: function() {
                const ctx = document.getElementById('monthlyChart-solar');
                if (!ctx) return;

                if (this.charts.monthly) {
                    this.charts.monthly.destroy();
                }

                const monthNames = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];

                this.charts.monthly = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: monthNames,
                        datasets: [{
                            label: 'æœˆé–“ç™ºé›»é‡ (kWh)',
                            data: this.results.monthlyGenerations,
                            backgroundColor: 'rgba(0, 91, 171, 0.7)',
                            borderColor: 'rgba(0, 91, 171, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'ç™ºé›»é‡ (kWh)'
                                }
                            }
                        }
                    }
                });
            },

            // åŠ¹ç‡ãƒ­ã‚¹ãƒãƒ£ãƒ¼ãƒˆ
            updateLossChart: function() {
                const ctx = document.getElementById('lossChart-solar');
                if (!ctx) return;

                if (this.charts.loss) {
                    this.charts.loss.destroy();
                }

                const labels = ['å®Ÿç™ºé›»é‡', 'å¤©å€™ã«ã‚ˆã‚‹æå¤±', 'æ–¹ä½ãƒ»å‚¾æ–œè§’ã«ã‚ˆã‚‹æå¤±', 'æ¸©åº¦ã«ã‚ˆã‚‹æå¤±', 'ãã®ä»–æå¤±'];
                const actualOutput = this.results.totalEfficiency / 100;
                const weatherLoss = (100 - this.results.weatherFactor) / 100;
                const orientationLoss = (100 - this.results.orientationFactor) / 100 * 0.5;
                const temperatureLoss = (100 - this.results.temperatureFactor) / 100 * 0.3;
                const otherLoss = 1 - actualOutput - weatherLoss - orientationLoss - temperatureLoss;

                const data = [actualOutput, weatherLoss, orientationLoss, temperatureLoss, Math.max(0, otherLoss)];
                const backgroundColor = ['rgba(76, 175, 80, 0.7)', '#2196f3', '#ff9800', '#f44336', '#9c27b0'];

                this.charts.loss = new Chart(ctx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: backgroundColor,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        return `${label}: ${(value * 100).toFixed(1)}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            },

            // ãƒ‘ãƒãƒ«é…ç½®å›³ã®æç”»
            renderPanelGrid: function() {
                const container = document.getElementById('panelGridContainer-solar');
                if (!container) return;

                const panelsPerString = Math.floor(this.config.panelCount / this.config.stringCount);
                const remainder = this.config.panelCount % this.config.stringCount;

                let html = '<div>';
                
                for (let i = 0; i < this.config.stringCount; i++) {
                    const panelCount = panelsPerString + (i < remainder ? 1 : 0);
                    html += `<div class="string-row">`;
                    html += `<span class="string-label">String ${i + 1}:</span>`;
                    
                    for (let j = 0; j < panelCount; j++) {
                        html += `<div class="panel-unit"></div>`;
                    }
                    
                    html += `<span class="string-info">${panelCount}æš (${(panelCount * this.config.panelPower).toFixed(0)}W)</span>`;
                    html += `</div>`;
                }
                
                html += '</div>';
                container.innerHTML = html;
            }
        };

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å¤ªé™½å…‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®åˆæœŸåŒ–
            SolarSimulator.init();
            
            // åˆæœŸã‚¿ãƒ–ã‚’è¡¨ç¤ºï¼ˆå›è·¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’æœ€åˆã«è¡¨ç¤ºï¼‰
            showTab('circuit-rich');
        });
    </script>
</body>
</html>